<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management System - Live Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .font-system { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .glass { backdrop-filter: blur(20px) saturate(180%); background: rgba(255, 255, 255, 0.25); border: 1px solid rgba(255, 255, 255, 0.18); }
        .glass-button { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); transition: all 0.2s ease; }
        .glass-button:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-1px); }
        .glass-shadow { box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37); }
        
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #f8f9fa, #e9ecef, #dee2e6, #ced4da, #adb5bd, #f1f3f4);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.05));
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: bubbleFloat 25s infinite linear;
            backdrop-filter: blur(2px);
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        @keyframes bubbleFloat {
            0% { 
                transform: translateY(100vh) translateX(0px) scale(0.3);
                opacity: 0;
            }
            10% { opacity: 0.4; }
            20% { 
                transform: translateY(80vh) translateX(10px) scale(0.6);
            }
            40% { 
                transform: translateY(60vh) translateX(-5px) scale(0.8);
                opacity: 0.6;
            }
            60% { 
                transform: translateY(40vh) translateX(15px) scale(1);
                opacity: 0.5;
            }
            80% { 
                transform: translateY(20vh) translateX(-10px) scale(0.7);
                opacity: 0.3;
            }
            100% { 
                transform: translateY(-5vh) translateX(5px) scale(0.2);
                opacity: 0;
            }
        }
        
        .ios-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .ios-shadow {
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
</head>
<body class="h-screen overflow-hidden font-system relative">
    <div class="animated-bg"></div>
    <div class="floating-shapes" id="floating-shapes"></div>

    <div class="flex">
        <!-- Sidebar -->
        <div class="w-72 h-screen fixed left-0 top-0 z-40" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(40px) saturate(180%); border-right: 1px solid rgba(255, 255, 255, 0.2);">
            <!-- Header -->
            <div class="p-8" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="flex items-center mb-6">
                    <div class="w-14 h-14 rounded-3xl flex items-center justify-center mr-4" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.8), rgba(139, 92, 246, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);">
                        <i data-lucide="graduation-cap" class="w-8 h-8 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 mb-1">Holy Cross</h1>
                        <p class="text-sm text-gray-600 font-medium">School System</p>
                    </div>
                </div>
                <div class="rounded-2xl p-4" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                    <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Current Session</p>
                    <p class="text-sm font-bold text-gray-800">Academic Year 2024-25</p>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="p-6">
                <div class="space-y-4">
                    <div class="mb-8">
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 px-4">Main Menu</p>
                        
                        <a href="#dashboard" onclick="showSection('dashboard')" class="nav-link active flex items-center px-4 py-3 text-sm font-semibold rounded-xl text-white mb-2 transition-all duration-300" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(20px); box-shadow: 0 8px 32px rgba(59, 130, 246, 0.4);">
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center mr-3" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                                <i data-lucide="layout-dashboard" class="w-4 h-4"></i>
                            </div>
                            <span>Dashboard</span>
                        </a>
                        
                        <a href="#students" onclick="showSection('students')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 mb-2 transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center mr-3" style="background: rgba(59, 130, 246, 0.1); backdrop-filter: blur(10px);">
                                <i data-lucide="users" class="w-4 h-4 text-blue-600"></i>
                            </div>
                            <span>Students</span>
                        </a>
                    </div>
                    
                    <div class="mb-8">
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 px-4">QR System</p>
                        
                        <a href="#qr-scanner" onclick="showSection('qr-scanner')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 mb-2 transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center mr-3" style="background: rgba(34, 197, 94, 0.1); backdrop-filter: blur(10px);">
                                <i data-lucide="scan" class="w-4 h-4 text-green-600"></i>
                            </div>
                            <span>QR Scanner</span>
                        </a>
                        
                        <a href="#generate-qr" onclick="showSection('generate-qr')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 mb-2 transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center mr-3" style="background: rgba(147, 51, 234, 0.1); backdrop-filter: blur(10px);">
                                <i data-lucide="qr-code" class="w-4 h-4 text-purple-600"></i>
                            </div>
                            <span>Generate QR</span>
                        </a>
                    </div>
                    
                    <div>
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 px-4">Management</p>
                        
                        <a href="#blocked" onclick="showSection('blocked')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 mb-2 transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center mr-3" style="background: rgba(239, 68, 68, 0.1); backdrop-filter: blur(10px);">
                                <i data-lucide="user-x" class="w-4 h-4 text-red-600"></i>
                            </div>
                            <span>Blocked Students</span>
                        </a>
                        
                        <a href="#settings" onclick="openSettings()" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center mr-3" style="background: rgba(107, 114, 128, 0.1); backdrop-filter: blur(10px);">
                                <i data-lucide="settings" class="w-4 h-4 text-gray-600"></i>
                            </div>
                            <span>Settings</span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6 h-screen overflow-y-auto ml-72">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <!-- Header with Clock -->
                <div class="rounded-2xl p-6 mb-6" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                                <div class="w-10 h-10 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);">
                                    <i data-lucide="activity" class="w-5 h-5 text-white"></i>
                                </div>
                                Dashboard Overview
                            </h2>
                            <p class="text-gray-600 ml-13">
                                Real-time attendance monitoring and analytics
                            </p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div id="live-clock-dash" class="font-mono text-xl font-bold text-gray-900">00:00:00</div>
                                <div id="live-date-dash" class="text-xs text-gray-600">Loading...</div>
                            </div>
                            <div class="text-right p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <p class="font-bold text-gray-900">Admin User</p>
                                <p class="text-gray-600 text-sm">admin@school.com</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="p-6 rounded-2xl hover:scale-105 transition-all duration-300" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 20px 40px rgba(59, 130, 246, 0.15);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-600 text-sm font-bold uppercase tracking-wide mb-2">Total Students</p>
                                <p id="total-students" class="text-3xl font-bold text-blue-900 mb-1">120</p>
                                <p class="text-blue-700 text-xs font-semibold">Enrolled</p>
                            </div>
                            <div class="p-3 rounded-xl" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(59, 130, 246, 0.4);">
                                <i data-lucide="users" class="w-8 h-8 text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 rounded-2xl hover:scale-105 transition-all duration-300" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 20px 40px rgba(34, 197, 94, 0.15);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-600 text-sm font-bold uppercase tracking-wide mb-2">Present Today</p>
                                <p id="present-today" class="text-3xl font-bold text-green-900 mb-1">24</p>
                                <p class="text-green-700 text-xs font-semibold">Active</p>
                            </div>
                            <div class="p-3 rounded-xl" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(16, 185, 129, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(34, 197, 94, 0.4);">
                                <i data-lucide="user-check" class="w-8 h-8 text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 rounded-2xl hover:scale-105 transition-all duration-300" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 20px 40px rgba(239, 68, 68, 0.15);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-600 text-sm font-bold uppercase tracking-wide mb-2">Absent Today</p>
                                <p id="absent-today" class="text-3xl font-bold text-red-900 mb-1">6</p>
                                <p class="text-red-700 text-xs font-semibold">Missing</p>
                            </div>
                            <div class="p-3 rounded-xl" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(239, 68, 68, 0.4);">
                                <i data-lucide="user-x" class="w-8 h-8 text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 rounded-2xl hover:scale-105 transition-all duration-300" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 20px 40px rgba(147, 51, 234, 0.15);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-600 text-sm font-bold uppercase tracking-wide mb-2">Attendance Rate</p>
                                <p id="attendance-rate" class="text-3xl font-bold text-purple-900 mb-1">80%</p>
                                <p class="text-purple-700 text-xs font-semibold">Overall</p>
                            </div>
                            <div class="p-3 rounded-xl" style="background: linear-gradient(135deg, rgba(147, 51, 234, 0.9), rgba(139, 92, 246, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(147, 51, 234, 0.4);">
                                <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Analytics -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Main Chart -->
                    <div class="lg:col-span-2 rounded-2xl overflow-hidden" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);">
                        <!-- Chart Header -->
                        <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-2xl font-bold mb-2 flex items-center text-gray-900">
                                        <i data-lucide="trending-up" class="w-6 h-6 mr-3 text-blue-600"></i>
                                        Weekly Attendance Analytics
                                    </h3>
                                    <p class="text-gray-600 text-sm flex items-center">
                                        <i data-lucide="calendar-days" class="w-4 h-4 mr-2"></i>
                                        <span id="chart-date-range">Loading...</span> â€¢ Real-time Data
                                    </p>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <div class="text-right glass glass-shadow rounded-xl p-3">
                                        <div class="text-2xl font-bold text-blue-600" id="week-avg">0%</div>
                                        <div class="text-xs text-gray-500">Today's Rate</div>
                                    </div>
                                    <div class="flex flex-col space-y-2">
                                        <button onclick="updateAttendanceChart()" class="p-2 glass-button rounded-lg">
                                            <i data-lucide="refresh-cw" class="w-4 h-4 text-gray-600"></i>
                                        </button>
                                        <button onclick="exportChart()" class="p-2 glass-button rounded-lg">
                                            <i data-lucide="download" class="w-4 h-4 text-gray-600"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Enhanced Legend -->
                            <div class="flex items-center justify-between glass rounded-xl p-4">
                                <div class="flex space-x-6">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 bg-green-500 rounded-full mr-2 shadow-sm"></div>
                                        <span class="text-sm font-medium text-gray-700">Present (<span id="legend-present">0</span>)</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 bg-yellow-500 rounded-full mr-2 shadow-sm"></div>
                                        <span class="text-sm font-medium text-gray-700">Late (<span id="legend-late">0</span>)</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 bg-red-500 rounded-full mr-2 shadow-sm"></div>
                                        <span class="text-sm font-medium text-gray-700">Absent (<span id="legend-absent">120</span>)</span>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500 flex items-center">
                                    <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                    Updated: <span id="chart-updated" class="ml-1 font-medium">Just now</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chart Body -->
                        <div class="p-6 bg-gradient-to-br from-white to-gray-50">
                            <div class="relative h-80">
                                <canvas id="attendanceChart"></canvas>
                                <div class="absolute top-3 right-3 flex space-x-2">
                                    <div class="glass-button px-3 py-1 rounded-lg">
                                        <span class="text-xs font-medium text-gray-600 flex items-center">
                                            <i data-lucide="bar-chart-3" class="w-3 h-3 mr-1"></i>
                                            Interactive
                                        </span>
                                    </div>
                                    <div class="glass-button px-3 py-1 rounded-lg">
                                        <span class="text-xs font-medium text-green-600">Live</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chart Stats -->
                            <div class="grid grid-cols-3 gap-4 mt-6 pt-4 border-t border-gray-200">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-600" id="best-day-rate">0%</div>
                                    <div class="text-xs text-gray-500">Today's Rate</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-blue-600" id="total-scanned">0</div>
                                    <div class="text-xs text-gray-500">Total Scanned</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-red-600" id="remaining-absent">120</div>
                                    <div class="text-xs text-gray-500">Still Absent</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="space-y-6">
                        <!-- Today's Summary -->
                        <div class="rounded-2xl p-6 mb-6" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                            <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                                <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);">
                                    <i data-lucide="calendar-check" class="w-4 h-4 text-white"></i>
                                </div>
                                Today's Summary
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3);">
                                    <span class="text-gray-700 font-semibold">On Time</span>
                                    <span id="on-time-count" class="font-bold text-green-600">20</span>
                                </div>
                                <div class="flex justify-between items-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3);">
                                    <span class="text-gray-700 font-semibold">Late Arrivals</span>
                                    <span id="late-count" class="font-bold text-yellow-600">4</span>
                                </div>
                                <div class="flex justify-between items-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3);">
                                    <span class="text-gray-700 font-semibold">Not Present</span>
                                    <span id="absent-count" class="font-bold text-red-600">6</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Professional Calendar -->
                        <div class="rounded-2xl overflow-hidden" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                            <div class="p-4" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 class="text-lg font-bold flex items-center text-gray-900">
                                    <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.8), rgba(59, 130, 246, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(99, 102, 241, 0.3);">
                                        <i data-lucide="calendar" class="w-4 h-4 text-white"></i>
                                    </div>
                                    Calendar
                                </h4>
                            </div>
                            <div class="p-4">
                                <div class="text-center mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <button onclick="previousMonth()" class="p-1 hover:bg-gray-100 rounded">
                                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                        </button>
                                        <h5 id="calendar-month" class="font-semibold text-gray-800">December 2024</h5>
                                        <button onclick="nextMonth()" class="p-1 hover:bg-gray-100 rounded">
                                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-7 gap-1 text-xs">
                                    <div class="text-center font-medium text-gray-500 p-2">S</div>
                                    <div class="text-center font-medium text-gray-500 p-2">M</div>
                                    <div class="text-center font-medium text-gray-500 p-2">T</div>
                                    <div class="text-center font-medium text-gray-500 p-2">W</div>
                                    <div class="text-center font-medium text-gray-500 p-2">T</div>
                                    <div class="text-center font-medium text-gray-500 p-2">F</div>
                                    <div class="text-center font-medium text-gray-500 p-2">S</div>
                                </div>
                                <div id="calendar-days" class="grid grid-cols-7 gap-1 text-xs">
                                    <!-- Calendar days will be populated here -->
                                </div>
                                <div class="mt-4 pt-3 border-t border-gray-200">
                                    <div class="flex items-center justify-between text-xs text-gray-600">
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                            <span>High Attendance</span>
                                        </div>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-red-500 rounded-full mr-1"></div>
                                            <span>Low Attendance</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students Section -->
            <div id="students" class="section hidden">
                <!-- Header -->
                <div class="rounded-2xl p-6 mb-6" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                                <div class="w-10 h-10 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);">
                                    <i data-lucide="users" class="w-5 h-5 text-white"></i>
                                </div>
                                Student Management
                            </h2>
                            <p class="text-gray-600 ml-13">Manage student records and attendance data</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div class="text-2xl font-bold text-blue-600">120</div>
                                <div class="text-xs text-gray-600">Total Students</div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <input type="text" id="student-menu-search" placeholder="Search students..." class="px-4 py-2 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" oninput="searchStudentsMenu()">
                                <button onclick="clearStudentSearch()" class="px-4 py-2 rounded-xl text-gray-600 font-medium transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                    Clear
                                </button>
                            </div>
                            <button id="student-lock-btn" onclick="toggleStudentLock()" class="px-4 py-3 rounded-xl text-white font-medium flex items-center transition-all duration-300 hover:scale-105 mr-3" style="background: linear-gradient(135deg, rgba(107, 114, 128, 0.9), rgba(75, 85, 99, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(107, 114, 128, 0.4);">
                                <i data-lucide="lock" class="w-4 h-4 mr-2"></i>
                                <span id="student-lock-text">Lock Menu</span>
                            </button>
                            <button onclick="showAddStudent()" class="px-6 py-3 rounded-xl text-white font-medium flex items-center transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(59, 130, 246, 0.4);">
                                <i data-lucide="user-plus" class="w-5 h-5 mr-2"></i>
                                Add Student
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Class Grid -->
                <div class="rounded-2xl p-6 mb-6" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 flex items-center">
                            <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.8), rgba(16, 185, 129, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(34, 197, 94, 0.3);">
                                <i data-lucide="grid-3x3" class="w-4 h-4 text-white"></i>
                            </div>
                            Browse by Class
                        </h3>
                        <button onclick="renderAllStudentsList()" class="text-sm font-medium px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            Show All Classes
                        </button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <div onclick="showClassStudents('1')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(59, 130, 246, 0.15);">
                            <div class="text-3xl font-bold text-blue-600 mb-3">1</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 85%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">85% Today</div>
                        </div>
                        <div onclick="showClassStudents('2')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(34, 197, 94, 0.15);">
                            <div class="text-3xl font-bold text-green-600 mb-3">2</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-green-500 h-2 rounded-full transition-all duration-500" style="width: 88%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">88% Today</div>
                        </div>
                        <div onclick="showClassStudents('3')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(147, 51, 234, 0.15);">
                            <div class="text-3xl font-bold text-purple-600 mb-3">3</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" style="width: 92%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">92% Today</div>
                        </div>
                        <div onclick="showClassStudents('4')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(239, 68, 68, 0.15);">
                            <div class="text-3xl font-bold text-red-600 mb-3">4</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 87%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">87% Today</div>
                        </div>
                        <div onclick="showClassStudents('5')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(251, 191, 36, 0.15);">
                            <div class="text-3xl font-bold text-yellow-600 mb-3">5</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-yellow-500 h-2 rounded-full transition-all duration-500" style="width: 90%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">90% Today</div>
                        </div>
                        <div onclick="showClassStudents('6')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(99, 102, 241, 0.15);">
                            <div class="text-3xl font-bold text-indigo-600 mb-3">6</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-indigo-500 h-2 rounded-full transition-all duration-500" style="width: 89%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">89% Today</div>
                        </div>
                        <div onclick="showClassStudents('7')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(236, 72, 153, 0.15);">
                            <div class="text-3xl font-bold text-pink-600 mb-3">7</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-pink-500 h-2 rounded-full transition-all duration-500" style="width: 91%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">91% Today</div>
                        </div>
                        <div onclick="showClassStudents('8')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(20, 184, 166, 0.15);">
                            <div class="text-3xl font-bold text-teal-600 mb-3">8</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-teal-500 h-2 rounded-full transition-all duration-500" style="width: 86%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">86% Today</div>
                        </div>
                        <div onclick="showClassStudents('9')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(249, 115, 22, 0.15);">
                            <div class="text-3xl font-bold text-orange-600 mb-3">9</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-orange-500 h-2 rounded-full transition-all duration-500" style="width: 93%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">93% Today</div>
                        </div>
                        <div onclick="showClassStudents('10')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(34, 197, 94, 0.15);">
                            <div class="text-3xl font-bold text-green-600 mb-3">10</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-green-500 h-2 rounded-full transition-all duration-500" style="width: 90%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">90% Today</div>
                        </div>
                        <div onclick="showClassStudents('11')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(6, 182, 212, 0.15);">
                            <div class="text-3xl font-bold text-cyan-600 mb-3">11</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-cyan-500 h-2 rounded-full transition-all duration-500" style="width: 94%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">94% Today</div>
                        </div>
                        <div onclick="showClassStudents('12')" class="p-5 rounded-2xl cursor-pointer text-center transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(147, 51, 234, 0.15);">
                            <div class="text-3xl font-bold text-purple-600 mb-3">12</div>
                            <div class="text-sm font-semibold text-gray-700 mb-3">10 Students</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" style="width: 95%"></div>
                            </div>
                            <div class="text-xs font-medium text-gray-600 mt-2">95% Today</div>
                        </div>
                    </div>
                </div>
                
                <!-- All Students List -->
                <div class="rounded-2xl overflow-hidden mt-6" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                    <div class="p-6" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
                        <h3 class="text-xl font-bold text-gray-900 flex items-center">
                            <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(147, 51, 234, 0.8), rgba(139, 92, 246, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(147, 51, 234, 0.3);">
                                <i data-lucide="list" class="w-4 h-4 text-white"></i>
                            </div>
                            Student Directory
                        </h3>
                        <p class="text-gray-600 text-sm mt-2 ml-11">Complete list of all enrolled students</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Student</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Class</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Section</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Attendance</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-students-list" style="background: rgba(255, 255, 255, 0.05);">
                                <!-- Students will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- QR Scanner Section -->
            <div id="qr-scanner" class="section hidden">
                <!-- Header -->
                <div class="rounded-2xl p-6 mb-6" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                                <div class="w-10 h-10 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.8), rgba(16, 185, 129, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(34, 197, 94, 0.3);">
                                    <i data-lucide="scan" class="w-5 h-5 text-white"></i>
                                </div>
                                QR Scanner System
                            </h2>
                            <p class="text-gray-600 ml-13">Professional attendance scanning with dual timer control</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div id="scanner-status-text" class="text-xl font-bold text-red-600">Inactive</div>
                                <div class="text-xs text-gray-600">Scanner Status</div>
                            </div>
                            <button id="lock-btn" onclick="toggleLock()" class="px-4 py-3 rounded-xl text-white font-medium flex items-center transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(107, 114, 128, 0.9), rgba(75, 85, 99, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(107, 114, 128, 0.4);">
                                <i data-lucide="lock" class="w-4 h-4 mr-2"></i>
                                <span id="lock-text">Lock Menu</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Scanner Interface -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <!-- Attendance Timer -->
                    <div class="rounded-2xl p-6" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(34, 197, 94, 0.15);">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.8), rgba(16, 185, 129, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(34, 197, 94, 0.3);">
                                <i data-lucide="clock" class="w-4 h-4 text-white"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900">Attendance Timer</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Minutes</label>
                                    <input type="number" value="5" id="timer-minutes" class="w-full px-3 py-3 rounded-xl border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all text-center font-mono text-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Seconds</label>
                                    <input type="number" value="0" id="timer-seconds" class="w-full px-3 py-3 rounded-xl border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all text-center font-mono text-lg">
                                </div>
                            </div>
                            <button id="attendance-timer-btn" onclick="startTimer()" class="w-full py-3 rounded-xl text-white font-semibold transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(16, 185, 129, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(34, 197, 94, 0.4);">
                                <i data-lucide="play" class="w-4 h-4 inline mr-2"></i>
                                Start Attendance Timer
                            </button>
                            <button id="attendance-stop-btn" onclick="stopAttendanceTimer()" class="w-full py-2 rounded-xl text-white font-medium transition-all duration-300 hover:scale-105 hidden mt-2" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(239, 68, 68, 0.4);">
                                <i data-lucide="square" class="w-4 h-4 inline mr-2"></i>
                                Force Stop
                            </button>
                            <div id="attendance-timer-display" class="text-center text-2xl font-bold text-green-600 hidden p-3 rounded-xl mt-4" style="background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3);">05:00</div>
                        </div>
                    </div>
                    
                    <!-- Absent Timer -->
                    <div class="rounded-2xl p-6" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(239, 68, 68, 0.15);">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.8), rgba(220, 38, 127, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(239, 68, 68, 0.3);">
                                <i data-lucide="timer" class="w-4 h-4 text-white"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900">Absent Timer</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Minutes</label>
                                    <input type="number" value="10" id="absent-timer-minutes" class="w-full px-3 py-3 rounded-xl border border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all text-center font-mono text-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Seconds</label>
                                    <input type="number" value="0" id="absent-timer-seconds" class="w-full px-3 py-3 rounded-xl border border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all text-center font-mono text-lg">
                                </div>
                            </div>
                            <button onclick="startAbsentTimer()" id="absent-timer-btn" class="w-full py-3 rounded-xl text-white font-semibold transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(239, 68, 68, 0.4);">
                                <i data-lucide="clock-x" class="w-4 h-4 inline mr-2"></i>
                                Start Absent Timer
                            </button>
                            <button id="absent-stop-btn" onclick="stopAbsentTimer()" class="w-full py-2 rounded-xl text-white font-medium transition-all duration-300 hover:scale-105 hidden mt-2" style="background: linear-gradient(135deg, rgba(107, 114, 128, 0.9), rgba(75, 85, 99, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(107, 114, 128, 0.4);">
                                <i data-lucide="square" class="w-4 h-4 inline mr-2"></i>
                                Force Stop
                            </button>
                            <div id="absent-timer-display" class="text-center text-2xl font-bold text-red-600 hidden p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3);">00:00</div>
                        </div>
                    </div>
                    
                    <!-- Camera Scanner -->
                    <div class="rounded-2xl p-6" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 15px 30px rgba(59, 130, 246, 0.15);">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);">
                                <i data-lucide="camera" class="w-4 h-4 text-white"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900">Camera Scanner</h3>
                        </div>
                        <div class="rounded-2xl h-48 mb-4 relative overflow-hidden" style="background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3);">
                            <video id="scanner-video" class="w-full h-full object-cover hidden" autoplay></video>
                            <canvas id="scanner-canvas" class="hidden"></canvas>
                            <div id="scanner-placeholder" class="w-full h-full flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-16 h-16 rounded-2xl mx-auto mb-3 flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1); backdrop-filter: blur(10px);">
                                        <i data-lucide="video" class="w-8 h-8 text-blue-500"></i>
                                    </div>
                                    <p class="text-gray-600 font-medium">Camera Preview</p>
                                    <p class="text-gray-500 text-sm">Ready to scan QR codes</p>
                                </div>
                            </div>
                            <div id="scan-result" class="absolute inset-0 flex items-center justify-center bg-green-500 bg-opacity-90 text-white font-bold text-lg hidden">
                                <div class="text-center">
                                    <i data-lucide="check-circle" class="w-12 h-12 mx-auto mb-2"></i>
                                    <div id="scan-message">Scan Successful!</div>
                                </div>
                            </div>
                        </div>
                        <button id="scanner-btn" onclick="toggleScanner()" class="w-full py-3 rounded-xl text-white font-semibold transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(59, 130, 246, 0.4);">
                            <i data-lucide="scan-line" class="w-4 h-4 inline mr-2"></i>
                            Activate Scanner
                        </button>
                        <div class="mt-4">
                            <input type="text" id="manual-scan" placeholder="Or enter student ID manually (e.g., HCS1001)" class="w-full px-4 py-2 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" onkeypress="handleManualScan(event)">
                        </div>
                    </div>
                </div>
                
                <!-- Scanner Statistics & Controls -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Live Statistics -->
                    <div class="rounded-2xl p-6" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                        <div class="flex items-center mb-6">
                            <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(147, 51, 234, 0.8), rgba(139, 92, 246, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(147, 51, 234, 0.3);">
                                <i data-lucide="bar-chart-3" class="w-4 h-4 text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900">Live Statistics</h3>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="p-4 rounded-xl text-center" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div class="text-2xl font-bold text-purple-600 font-mono" id="session-timer">00:00</div>
                                <div class="text-sm text-gray-600 font-medium">Session Time</div>
                            </div>
                            <div class="p-4 rounded-xl text-center" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div class="text-2xl font-bold text-green-600" id="scanned-today">0</div>
                                <div class="text-sm text-gray-600 font-medium">Scanned Today</div>
                            </div>
                            <div class="p-4 rounded-xl text-center" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <div class="text-2xl font-bold text-blue-600" id="scan-rate">0%</div>
                                <div class="text-sm text-gray-600 font-medium">Scan Rate</div>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(15px);">
                                <span class="text-gray-700 font-medium">Present</span>
                                <span class="font-bold text-green-600" id="present-scanned">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(15px);">
                                <span class="text-gray-700 font-medium">Late Arrivals</span>
                                <span class="font-bold text-yellow-600" id="late-scanned">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(15px);">
                                <span class="text-gray-700 font-medium">Not Scanned</span>
                                <span class="font-bold text-red-600" id="not-scanned">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Scans & Controls -->
                    <div class="rounded-2xl overflow-hidden" style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
                        <div class="p-6 border-b" style="border-color: rgba(255, 255, 255, 0.2);">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.8), rgba(245, 158, 11, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3);">
                                        <i data-lucide="history" class="w-4 h-4 text-white"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-900">Recent Activity</h3>
                                </div>
                                <button onclick="clearScanHistory()" class="text-sm font-medium px-3 py-1 rounded-lg transition-all duration-200 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
                                    Clear
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div id="recent-scans" class="space-y-3 mb-6 max-h-48 overflow-y-auto">
                                <div class="text-center text-gray-500 py-8">
                                    <i data-lucide="scan-line" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-sm">No recent scans</p>
                                </div>
                            </div>
                            
                            <!-- Advanced Controls -->
                            <div class="space-y-3">
                                <button onclick="simulateScan()" class="w-full py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); color: #374151;">
                                    <i data-lucide="zap" class="w-4 h-4 inline mr-2"></i>
                                    Simulate Scan
                                </button>
                                <button onclick="exportScanData()" class="w-full py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105" style="background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); color: #374151;">
                                    <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>
                                    Export Scan Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generate QR Section -->
            <div id="generate-qr" class="section hidden">
                <div class="glass glass-shadow rounded-2xl p-6 mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-1">QR Generator</h2>
                            <p class="text-gray-600">Generate student QR codes</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center">
                            <i data-lucide="qr-code" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Generator Interface -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Student Selection -->
                    <div class="glass glass-shadow rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Student Selection</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Filter by Class</label>
                                <select id="class-filter" class="w-full px-3 py-2 border rounded-lg" onchange="filterStudents()">
                                    <option value="">All Classes</option>
                                    <option value="1">Class 1</option>
                                    <option value="2">Class 2</option>
                                    <option value="3">Class 3</option>
                                    <option value="4">Class 4</option>
                                    <option value="5">Class 5</option>
                                    <option value="6">Class 6</option>
                                    <option value="7">Class 7</option>
                                    <option value="8">Class 8</option>
                                    <option value="9">Class 9</option>
                                    <option value="10">Class 10</option>
                                    <option value="11">Class 11</option>
                                    <option value="12">Class 12</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Select Student</label>
                                <select id="student-select" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="">Choose a student...</option>
                                </select>
                            </div>
                            <button onclick="generateQR()" class="w-full bg-purple-500 text-white py-2 rounded-lg">Generate QR</button>
                        </div>
                    </div>
                    
                    <!-- QR Display -->
                    <div class="glass glass-shadow rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Generated QR Code</h3>
                        <div id="qr-display" class="bg-gray-100 rounded-xl h-48 flex items-center justify-center">
                            <div class="text-center">
                                <i data-lucide="qr-code" class="w-12 h-12 text-gray-400 mx-auto mb-2"></i>
                                <p class="text-gray-500">QR code will appear here</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-4">
                            <button onclick="downloadQR()" class="bg-green-500 text-white py-2 rounded-lg">Download</button>
                            <button onclick="printQR()" class="bg-blue-500 text-white py-2 rounded-lg">Print</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blocked Students Section -->
            <div id="blocked" class="section hidden">
                <div class="glass glass-shadow rounded-2xl p-6 mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-1">Blocked Students</h2>
                            <p class="text-gray-600 flex items-center">
                                <i data-lucide="user-x" class="w-4 h-4 mr-2"></i>
                                Manage blocked students who cannot scan QR codes
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-red-500 rounded-lg flex items-center justify-center glass-shadow">
                            <i data-lucide="shield-x" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="glass glass-shadow rounded-2xl p-4 mb-6">
                    <div class="grid grid-cols-4 gap-4">
                        <div class="glass glass-shadow p-6 rounded-2xl text-center">
                            <div class="text-3xl font-bold text-red-600 mb-2" id="blocked-count">0</div>
                            <div class="text-sm font-medium text-gray-700">Blocked</div>
                        </div>
                        <div class="glass glass-shadow p-6 rounded-2xl text-center">
                            <div class="text-3xl font-bold text-green-600 mb-2" id="active-count">120</div>
                            <div class="text-sm font-medium text-gray-700">Active</div>
                        </div>
                        <div class="glass glass-shadow p-6 rounded-2xl text-center">
                            <div class="text-3xl font-bold text-orange-600 mb-2">0</div>
                            <div class="text-sm font-medium text-gray-700">Blocked Today</div>
                        </div>
                        <div class="glass glass-shadow p-6 rounded-2xl text-center">
                            <div class="text-3xl font-bold text-blue-600 mb-2">0</div>
                            <div class="text-sm font-medium text-gray-700">Unblocked Today</div>
                        </div>
                    </div>
                </div>
                
                <!-- Students List -->
                <div class="glass glass-shadow rounded-2xl overflow-hidden">
                    <div class="bg-gradient-to-r from-red-500 to-red-600 p-4 text-white">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-semibold">All Students</h3>
                            <div class="flex items-center space-x-3">
                                <button onclick="blockAllStudents()" class="glass-button text-xs font-medium px-3 py-1 rounded-lg">
                                    Block All
                                </button>
                                <button onclick="unblockAllStudents()" class="glass-button text-xs font-medium px-3 py-1 rounded-lg">
                                    Unblock All
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <input type="text" id="student-search" placeholder="Search by name or ID..." class="flex-1 px-3 py-2 rounded-lg text-gray-900 text-sm" oninput="searchStudents()">
                            <button onclick="clearSearch()" class="glass-button text-xs font-medium px-3 py-1 rounded-lg">
                                Clear
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-white bg-opacity-50">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Student</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Class</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Block Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="blocked-students-list" class="bg-white divide-y divide-gray-200">
                                    <!-- Students will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="section hidden">
                <div class="glass glass-shadow rounded-2xl p-6 mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-1">Settings</h2>
                            <p class="text-gray-600">Configure application settings</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center">
                            <i data-lucide="cog" class="w-6 h-6 text-white"></i>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Password Management -->
                    <div class="glass glass-shadow rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i data-lucide="key" class="w-5 h-5 mr-2 text-red-600"></i>
                            Password Management
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Timer Password</label>
                                <div class="flex space-x-2">
                                    <input type="password" id="timer-password-setting" value="6073" class="flex-1 px-3 py-2 border rounded-md" onchange="updateTimerPassword()">
                                    <button onclick="changePassword('timer')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md text-xs">Change</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">For starting attendance/absent timers</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Block Student Password</label>
                                <div class="flex space-x-2">
                                    <input type="password" id="block-password-setting" value="6073" class="flex-1 px-3 py-2 border rounded-md" onchange="updateBlockPassword()">
                                    <button onclick="changePassword('block')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md text-xs">Change</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">For blocking/unblocking students</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Menu Lock Password</label>
                                <div class="flex space-x-2">
                                    <input type="password" id="lock-password-setting" value="6073" class="flex-1 px-3 py-2 border rounded-md" onchange="updateLockPassword()">
                                    <button onclick="changePassword('lock')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md text-xs">Change</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">For locking/unlocking menu navigation</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- App Configuration -->
                    <div class="glass glass-shadow rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">App Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">School Name</label>
                                <input type="text" id="school-name" value="Holy Cross School" class="w-full px-3 py-2 border rounded-md" onchange="updateSchoolName()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Academic Year</label>
                                <select id="academic-year" class="w-full px-3 py-2 border rounded-md" onchange="updateAcademicYear()">
                                    <option value="2025-2026">2025-2026</option>
                                    <option value="2024-2025" selected>2024-2025</option>
                                    <option value="2023-2024">2023-2024</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-1">Total Working Days</label>
                                <input type="number" id="working-days" value="200" class="w-full px-3 py-2 border rounded-md" onchange="updateWorkingDays()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Total Holidays</label>
                                <input type="number" id="total-holidays" value="50" class="w-full px-3 py-2 border rounded-md" onchange="updateHolidays()">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Management -->
                    <div class="glass glass-shadow rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Data Management</h3>
                        <div class="space-y-3">
                            <button onclick="exportData()" class="w-full bg-blue-600 text-white py-2 rounded-lg">Export All Data</button>
                            <button onclick="importData()" class="w-full bg-green-600 text-white py-2 rounded-lg">Import Data</button>
                            <button onclick="resetData()" class="w-full bg-red-600 text-white py-2 rounded-lg">Reset All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="change-password-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeChangePasswordModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="rounded-2xl p-6 w-full max-w-sm" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 flex items-center">
                        <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);">
                            <i data-lucide="key" class="w-4 h-4 text-white"></i>
                        </div>
                        <span id="change-password-title">Change Password</span>
                    </h3>
                    <button onclick="closeChangePasswordModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
                
                <div class="mb-6">
                    <p class="text-gray-600 mb-4" id="change-password-message">Enter new password:</p>
                    <input type="password" id="new-password-input" placeholder="Enter new password" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" onkeypress="handleNewPasswordEnter(event)">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closeChangePasswordModal()" class="flex-1 px-6 py-3 rounded-xl border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-all">
                        Cancel
                    </button>
                    <button onclick="saveNewPassword()" class="flex-1 px-6 py-3 rounded-xl text-white font-medium transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(59, 130, 246, 0.4);">
                        Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closePasswordModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="rounded-2xl p-6 w-full max-w-sm" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 flex items-center">
                        <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.8), rgba(220, 38, 127, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(239, 68, 68, 0.3);">
                            <i data-lucide="lock" class="w-4 h-4 text-white"></i>
                        </div>
                        Security Check
                    </h3>
                    <button onclick="closePasswordModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
                
                <div class="mb-6">
                    <p class="text-gray-600 mb-4" id="password-message">Enter password to continue:</p>
                    <input type="password" id="password-input" placeholder="Enter password" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all" onkeypress="handlePasswordEnter(event)">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closePasswordModal()" class="flex-1 px-6 py-3 rounded-xl border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-all">
                        Cancel
                    </button>
                    <button onclick="verifyPassword()" class="flex-1 px-6 py-3 rounded-xl text-white font-medium transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(239, 68, 68, 0.4);">
                        Verify
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="edit-student-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeEditStudentModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="rounded-2xl p-6 w-full max-w-md" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 flex items-center">
                        <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);">
                            <i data-lucide="edit" class="w-4 h-4 text-white"></i>
                        </div>
                        Edit Student
                    </h3>
                    <button onclick="closeEditStudentModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
                
                <form id="edit-student-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Student Name</label>
                        <input type="text" id="edit-name" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Enter full name">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Class</label>
                            <select id="edit-class" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <option value="">Select Class</option>
                                <option value="1">Class 1</option>
                                <option value="2">Class 2</option>
                                <option value="3">Class 3</option>
                                <option value="4">Class 4</option>
                                <option value="5">Class 5</option>
                                <option value="6">Class 6</option>
                                <option value="7">Class 7</option>
                                <option value="8">Class 8</option>
                                <option value="9">Class 9</option>
                                <option value="10">Class 10</option>
                                <option value="11">Class 11</option>
                                <option value="12">Class 12</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Section</label>
                            <select id="edit-section" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <option value="">Select Section</option>
                                <option value="A">Section A</option>
                                <option value="B">Section B</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                        <input type="email" id="edit-email" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="student@school.com">
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="button" onclick="closeEditStudentModal()" class="flex-1 px-6 py-3 rounded-xl border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-all">
                            Cancel
                        </button>
                        <button type="button" onclick="saveEditStudent()" class="flex-1 px-6 py-3 rounded-xl text-white font-medium transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(59, 130, 246, 0.4);">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="add-student-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeAddStudentModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="rounded-2xl p-6 w-full max-w-md" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(40px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 flex items-center">
                        <div class="w-8 h-8 rounded-xl mr-3 flex items-center justify-center" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.8)); backdrop-filter: blur(10px); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);">
                            <i data-lucide="user-plus" class="w-4 h-4 text-white"></i>
                        </div>
                        Add New Student
                    </h3>
                    <button onclick="closeAddStudentModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
                
                <form id="add-student-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Student Name</label>
                        <input type="text" name="name" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Enter full name">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Class</label>
                            <select name="class" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <option value="">Select Class</option>
                                <option value="1">Class 1</option>
                                <option value="2">Class 2</option>
                                <option value="3">Class 3</option>
                                <option value="4">Class 4</option>
                                <option value="5">Class 5</option>
                                <option value="6">Class 6</option>
                                <option value="7">Class 7</option>
                                <option value="8">Class 8</option>
                                <option value="9">Class 9</option>
                                <option value="10">Class 10</option>
                                <option value="11">Class 11</option>
                                <option value="12">Class 12</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Section</label>
                            <select name="section" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <option value="">Select Section</option>
                                <option value="A">Section A</option>
                                <option value="B">Section B</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                        <input type="email" name="email" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="student@school.com">
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="button" onclick="closeAddStudentModal()" class="flex-1 px-6 py-3 rounded-xl border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-all">
                            Cancel
                        </button>
                        <button type="button" onclick="addNewStudent()" class="flex-1 px-6 py-3 rounded-xl text-white font-medium transition-all duration-300 hover:scale-105" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9)); backdrop-filter: blur(10px); box-shadow: 0 12px 24px rgba(59, 130, 246, 0.4);">
                            Add Student
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Reset all students to 0% attendance on first load
        function resetAllAttendance() {
            Object.keys(studentsData).forEach(studentId => {
                studentsData[studentId].attendance = '0.0%';
                studentsData[studentId].presentDays = 0;
            });
            saveStudentsData();
        }
        
        // Complete student database - 120 students across all classes
        let studentsData = JSON.parse(localStorage.getItem('studentsData')) || {
            // Class 1 - 10 students
            'HCS0101': { name: 'John Doe', email: 'john1@school.com', class: '1', section: 'A', attendance: '0.0%', status: 'Absent', presentDays: 0, attendanceDate: null },
            'HCS0102': { name: 'Emma Wilson', email: 'emma1@school.com', class: '1', section: 'A', attendance: '0.0%', status: 'Absent', presentDays: 0, attendanceDate: null },
            'HCS0103': { name: 'Michael Brown', email: 'michael1@school.com', class: '1', section: 'B', attendance: '0.0%', status: 'Absent', presentDays: 0, attendanceDate: null },
            'HCS0104': { name: 'Sophia Davis', email: 'sophia1@school.com', class: '1', section: 'A', attendance: '90.0%', status: 'Absent', presentDays: 36, attendanceDate: null },
            'HCS0105': { name: 'James Wilson', email: 'james1@school.com', class: '1', section: 'B', attendance: '87.5%', status: 'Absent', presentDays: 35, attendanceDate: null },
            'HCS0106': { name: 'Olivia Miller', email: 'olivia1@school.com', class: '1', section: 'A', attendance: '93.0%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS0107': { name: 'William Garcia', email: 'william1@school.com', class: '1', section: 'B', attendance: '89.0%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS0108': { name: 'Ava Martinez', email: 'ava1@school.com', class: '1', section: 'A', attendance: '91.5%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS0109': { name: 'Benjamin Lee', email: 'benjamin1@school.com', class: '1', section: 'B', attendance: '86.0%', status: 'Not Scanned', presentDays: 34, attendanceDate: null },
            'HCS0110': { name: 'Charlotte Taylor', email: 'charlotte1@school.com', class: '1', section: 'A', attendance: '94.5%', status: 'Not Scanned', presentDays: 38, attendanceDate: null },
            
            // Class 2 - 10 students
            'HCS0201': { name: 'Alex Johnson', email: 'alex2@school.com', class: '2', section: 'A', attendance: '89.0%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS0202': { name: 'Maya Patel', email: 'maya2@school.com', class: '2', section: 'B', attendance: '91.5%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS0203': { name: 'Ryan Smith', email: 'ryan2@school.com', class: '2', section: 'A', attendance: '87.0%', status: 'Not Scanned', presentDays: 35, attendanceDate: null },
            'HCS0204': { name: 'Zoe Chen', email: 'zoe2@school.com', class: '2', section: 'B', attendance: '93.5%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS0205': { name: 'Noah Davis', email: 'noah2@school.com', class: '2', section: 'A', attendance: '88.5%', status: 'Not Scanned', presentDays: 35, attendanceDate: null },
            'HCS0206': { name: 'Lily Brown', email: 'lily2@school.com', class: '2', section: 'B', attendance: '90.0%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS0207': { name: 'Ethan Wilson', email: 'ethan2@school.com', class: '2', section: 'A', attendance: '85.5%', status: 'Not Scanned', presentDays: 34, attendanceDate: null },
            'HCS0208': { name: 'Grace Lee', email: 'grace2@school.com', class: '2', section: 'B', attendance: '92.0%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS0209': { name: 'Lucas Garcia', email: 'lucas2@school.com', class: '2', section: 'A', attendance: '89.5%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS0210': { name: 'Mia Martinez', email: 'mia2@school.com', class: '2', section: 'B', attendance: '94.0%', status: 'Not Scanned', presentDays: 38, attendanceDate: null },
            
            // Class 3 - 10 students
            'HCS0301': { name: 'Oliver Taylor', email: 'oliver3@school.com', class: '3', section: 'A', attendance: '91.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0302': { name: 'Isabella White', email: 'isabella3@school.com', class: '3', section: 'B', attendance: '88.5%', status: 'Late', presentDays: 35, attendanceDate: null },
            'HCS0303': { name: 'Mason Johnson', email: 'mason3@school.com', class: '3', section: 'A', attendance: '93.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0304': { name: 'Amelia Davis', email: 'amelia3@school.com', class: '3', section: 'B', attendance: '90.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0305': { name: 'Logan Brown', email: 'logan3@school.com', class: '3', section: 'A', attendance: '87.0%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0306': { name: 'Harper Wilson', email: 'harper3@school.com', class: '3', section: 'B', attendance: '94.5%', status: 'Present', presentDays: 38, attendanceDate: null },
            'HCS0307': { name: 'Jackson Lee', email: 'jackson3@school.com', class: '3', section: 'A', attendance: '89.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0308': { name: 'Evelyn Garcia', email: 'evelyn3@school.com', class: '3', section: 'B', attendance: '92.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0309': { name: 'Aiden Martinez', email: 'aiden3@school.com', class: '3', section: 'A', attendance: '86.5%', status: 'Absent', presentDays: 35, attendanceDate: null },
            'HCS0310': { name: 'Abigail Miller', email: 'abigail3@school.com', class: '3', section: 'B', attendance: '95.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 4 - 10 students
            'HCS0401': { name: 'Sebastian Chen', email: 'sebastian4@school.com', class: '4', section: 'A', attendance: '88.0%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0402': { name: 'Emily Taylor', email: 'emily4@school.com', class: '4', section: 'B', attendance: '91.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0403': { name: 'Carter White', email: 'carter4@school.com', class: '4', section: 'A', attendance: '89.5%', status: 'Late', presentDays: 36, attendanceDate: null },
            'HCS0404': { name: 'Madison Johnson', email: 'madison4@school.com', class: '4', section: 'B', attendance: '93.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0405': { name: 'Grayson Davis', email: 'grayson4@school.com', class: '4', section: 'A', attendance: '87.5%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0406': { name: 'Scarlett Brown', email: 'scarlett4@school.com', class: '4', section: 'B', attendance: '90.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0407': { name: 'Wyatt Wilson', email: 'wyatt4@school.com', class: '4', section: 'A', attendance: '85.0%', status: 'Absent', presentDays: 34, attendanceDate: null },
            'HCS0408': { name: 'Aria Lee', email: 'aria4@school.com', class: '4', section: 'B', attendance: '92.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0409': { name: 'Luke Garcia', email: 'luke4@school.com', class: '4', section: 'A', attendance: '88.5%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0410': { name: 'Chloe Martinez', email: 'chloe4@school.com', class: '4', section: 'B', attendance: '94.5%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 5 - 10 students
            'HCS0501': { name: 'Julian Miller', email: 'julian5@school.com', class: '5', section: 'A', attendance: '90.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0502': { name: 'Layla Chen', email: 'layla5@school.com', class: '5', section: 'B', attendance: '87.5%', status: 'Late', presentDays: 35, attendanceDate: null },
            'HCS0503': { name: 'Mateo Taylor', email: 'mateo5@school.com', class: '5', section: 'A', attendance: '92.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0504': { name: 'Penelope White', email: 'penelope5@school.com', class: '5', section: 'B', attendance: '89.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0505': { name: 'Leo Johnson', email: 'leo5@school.com', class: '5', section: 'A', attendance: '91.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0506': { name: 'Zoey Davis', email: 'zoey5@school.com', class: '5', section: 'B', attendance: '88.0%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0507': { name: 'Asher Brown', email: 'asher5@school.com', class: '5', section: 'A', attendance: '93.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0508': { name: 'Nora Wilson', email: 'nora5@school.com', class: '5', section: 'B', attendance: '86.5%', status: 'Absent', presentDays: 35, attendanceDate: null },
            'HCS0509': { name: 'Ezra Lee', email: 'ezra5@school.com', class: '5', section: 'A', attendance: '90.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0510': { name: 'Stella Garcia', email: 'stella5@school.com', class: '5', section: 'B', attendance: '94.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 6 - 10 students
            'HCS0601': { name: 'Levi Martinez', email: 'levi6@school.com', class: '6', section: 'A', attendance: '89.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0602': { name: 'Hazel Miller', email: 'hazel6@school.com', class: '6', section: 'B', attendance: '91.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0603': { name: 'Theo Chen', email: 'theo6@school.com', class: '6', section: 'A', attendance: '87.0%', status: 'Late', presentDays: 35, attendanceDate: null },
            'HCS0604': { name: 'Violet Taylor', email: 'violet6@school.com', class: '6', section: 'B', attendance: '93.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0605': { name: 'Adrian White', email: 'adrian6@school.com', class: '6', section: 'A', attendance: '88.5%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0606': { name: 'Aurora Johnson', email: 'aurora6@school.com', class: '6', section: 'B', attendance: '90.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0607': { name: 'Kai Davis', email: 'kai6@school.com', class: '6', section: 'A', attendance: '85.5%', status: 'Absent', presentDays: 34, attendanceDate: null },
            'HCS0608': { name: 'Savannah Brown', email: 'savannah6@school.com', class: '6', section: 'B', attendance: '92.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0609': { name: 'Felix Wilson', email: 'felix6@school.com', class: '6', section: 'A', attendance: '89.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0610': { name: 'Willow Lee', email: 'willow6@school.com', class: '6', section: 'B', attendance: '94.5%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 7 - 10 students
            'HCS0701': { name: 'Axel Garcia', email: 'axel7@school.com', class: '7', section: 'A', attendance: '91.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0702': { name: 'Brooklyn Martinez', email: 'brooklyn7@school.com', class: '7', section: 'B', attendance: '88.0%', status: 'Late', presentDays: 35, attendanceDate: null },
            'HCS0703': { name: 'Jaxon Miller', email: 'jaxon7@school.com', class: '7', section: 'A', attendance: '90.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0704': { name: 'Paisley Chen', email: 'paisley7@school.com', class: '7', section: 'B', attendance: '92.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0705': { name: 'Maverick Taylor', email: 'maverick7@school.com', class: '7', section: 'A', attendance: '87.5%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0706': { name: 'Skylar White', email: 'skylar7@school.com', class: '7', section: 'B', attendance: '93.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0707': { name: 'Ryder Johnson', email: 'ryder7@school.com', class: '7', section: 'A', attendance: '86.0%', status: 'Absent', presentDays: 34, attendanceDate: null },
            'HCS0708': { name: 'Luna Davis', email: 'luna7@school.com', class: '7', section: 'B', attendance: '91.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0709': { name: 'Jace Brown', email: 'jace7@school.com', class: '7', section: 'A', attendance: '89.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0710': { name: 'Nova Wilson', email: 'nova7@school.com', class: '7', section: 'B', attendance: '94.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 8 - 10 students
            'HCS0801': { name: 'Knox Lee', email: 'knox8@school.com', class: '8', section: 'A', attendance: '86.5%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0802': { name: 'Emilia Garcia', email: 'emilia8@school.com', class: '8', section: 'B', attendance: '90.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0803': { name: 'River Martinez', email: 'river8@school.com', class: '8', section: 'A', attendance: '88.5%', status: 'Late', presentDays: 35, attendanceDate: null },
            'HCS0804': { name: 'Ivy Miller', email: 'ivy8@school.com', class: '8', section: 'B', attendance: '91.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0805': { name: 'Atlas Chen', email: 'atlas8@school.com', class: '8', section: 'A', attendance: '87.0%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0806': { name: 'Sage Taylor', email: 'sage8@school.com', class: '8', section: 'B', attendance: '92.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0807': { name: 'Orion White', email: 'orion8@school.com', class: '8', section: 'A', attendance: '84.5%', status: 'Absent', presentDays: 34, attendanceDate: null },
            'HCS0808': { name: 'Quinn Johnson', email: 'quinn8@school.com', class: '8', section: 'B', attendance: '89.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0809': { name: 'Phoenix Davis', email: 'phoenix8@school.com', class: '8', section: 'A', attendance: '90.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0810': { name: 'Rowan Brown', email: 'rowan8@school.com', class: '8', section: 'B', attendance: '93.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            
            // Class 9 - 10 students
            'HCS0901': { name: 'Zion Wilson', email: 'zion9@school.com', class: '9', section: 'A', attendance: '93.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0902': { name: 'Serenity Lee', email: 'serenity9@school.com', class: '9', section: 'B', attendance: '89.0%', status: 'Late', presentDays: 36, attendanceDate: null },
            'HCS0903': { name: 'Jasper Garcia', email: 'jasper9@school.com', class: '9', section: 'A', attendance: '91.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0904': { name: 'Melody Martinez', email: 'melody9@school.com', class: '9', section: 'B', attendance: '94.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            'HCS0905': { name: 'Archer Miller', email: 'archer9@school.com', class: '9', section: 'A', attendance: '88.5%', status: 'Present', presentDays: 35, attendanceDate: null },
            'HCS0906': { name: 'Journey Chen', email: 'journey9@school.com', class: '9', section: 'B', attendance: '92.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS0907': { name: 'Cruz Taylor', email: 'cruz9@school.com', class: '9', section: 'A', attendance: '87.0%', status: 'Absent', presentDays: 35, attendanceDate: null },
            'HCS0908': { name: 'Harmony White', email: 'harmony9@school.com', class: '9', section: 'B', attendance: '90.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0909': { name: 'Onyx Johnson', email: 'onyx9@school.com', class: '9', section: 'A', attendance: '89.5%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS0910': { name: 'Rayna Davis', email: 'rayna9@school.com', class: '9', section: 'B', attendance: '95.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 10 - 10 students
            'HCS1001': { name: 'Alice Johnson', email: 'alice@school.com', class: '10', section: 'A', attendance: '95.2%', status: 'Absent', presentDays: 38, attendanceDate: null },
            'HCS1002': { name: 'Bob Smith', email: 'bob@school.com', class: '10', section: 'B', attendance: '88.7%', status: 'Absent', presentDays: 35, attendanceDate: null },
            'HCS1003': { name: 'Carol White', email: 'carol@school.com', class: '10', section: 'A', attendance: '92.0%', status: 'Absent', presentDays: 37, attendanceDate: null },
            'HCS1004': { name: 'David Brown', email: 'david@school.com', class: '10', section: 'B', attendance: '89.5%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS1005': { name: 'Eva Green', email: 'eva@school.com', class: '10', section: 'A', attendance: '96.0%', status: 'Not Scanned', presentDays: 38, attendanceDate: null },
            'HCS1006': { name: 'Frank Miller', email: 'frank@school.com', class: '10', section: 'B', attendance: '87.0%', status: 'Not Scanned', presentDays: 35, attendanceDate: null },
            'HCS1007': { name: 'Grace Wilson', email: 'grace@school.com', class: '10', section: 'A', attendance: '93.5%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS1008': { name: 'Henry Davis', email: 'henry@school.com', class: '10', section: 'B', attendance: '90.0%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS1009': { name: 'Ivy Taylor', email: 'ivy@school.com', class: '10', section: 'A', attendance: '85.5%', status: 'Not Scanned', presentDays: 34, attendanceDate: null },
            'HCS1010': { name: 'Jack Anderson', email: 'jack@school.com', class: '10', section: 'B', attendance: '91.0%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            
            // Class 11 - 10 students
            'HCS1101': { name: 'Kai Brown', email: 'kai11@school.com', class: '11', section: 'A', attendance: '94.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            'HCS1102': { name: 'Zara Wilson', email: 'zara11@school.com', class: '11', section: 'B', attendance: '90.5%', status: 'Late', presentDays: 36, attendanceDate: null },
            'HCS1103': { name: 'Finn Lee', email: 'finn11@school.com', class: '11', section: 'A', attendance: '92.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS1104': { name: 'Maya Garcia', email: 'maya11@school.com', class: '11', section: 'B', attendance: '95.5%', status: 'Present', presentDays: 38, attendanceDate: null },
            'HCS1105': { name: 'Jude Martinez', email: 'jude11@school.com', class: '11', section: 'A', attendance: '89.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS1106': { name: 'Iris Miller', email: 'iris11@school.com', class: '11', section: 'B', attendance: '91.5%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS1107': { name: 'Sage Chen', email: 'sage11@school.com', class: '11', section: 'A', attendance: '87.5%', status: 'Absent', presentDays: 35, attendanceDate: null },
            'HCS1108': { name: 'River Taylor', email: 'river11@school.com', class: '11', section: 'B', attendance: '93.0%', status: 'Present', presentDays: 37, attendanceDate: null },
            'HCS1109': { name: 'Atlas White', email: 'atlas11@school.com', class: '11', section: 'A', attendance: '90.0%', status: 'Present', presentDays: 36, attendanceDate: null },
            'HCS1110': { name: 'Luna Johnson', email: 'luna11@school.com', class: '11', section: 'B', attendance: '96.0%', status: 'Present', presentDays: 38, attendanceDate: null },
            
            // Class 12 - 10 students
            'HCS1201': { name: 'Sarah Davis', email: 'sarah@school.com', class: '12', section: 'A', attendance: '97.8%', status: 'Absent', presentDays: 39, attendanceDate: null },
            'HCS1202': { name: 'Mike Johnson', email: 'mike@school.com', class: '12', section: 'B', attendance: '85.3%', status: 'Not Scanned', presentDays: 34, attendanceDate: null },
            'HCS1203': { name: 'Lisa Chen', email: 'lisa@school.com', class: '12', section: 'A', attendance: '94.0%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS1204': { name: 'Tom Wilson', email: 'tom@school.com', class: '12', section: 'B', attendance: '91.5%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS1205': { name: 'Anna Garcia', email: 'anna@school.com', class: '12', section: 'A', attendance: '96.5%', status: 'Not Scanned', presentDays: 39, attendanceDate: null },
            'HCS1206': { name: 'Chris Brown', email: 'chris@school.com', class: '12', section: 'B', attendance: '88.0%', status: 'Not Scanned', presentDays: 35, attendanceDate: null },
            'HCS1207': { name: 'Diana Lee', email: 'diana@school.com', class: '12', section: 'A', attendance: '93.0%', status: 'Not Scanned', presentDays: 37, attendanceDate: null },
            'HCS1208': { name: 'Eric Martinez', email: 'eric@school.com', class: '12', section: 'B', attendance: '89.5%', status: 'Not Scanned', presentDays: 36, attendanceDate: null },
            'HCS1209': { name: 'Fiona Taylor', email: 'fiona@school.com', class: '12', section: 'A', attendance: '95.0%', status: 'Not Scanned', presentDays: 38, attendanceDate: null },
            'HCS1210': { name: 'George White', email: 'george@school.com', class: '12', section: 'B', attendance: '87.5%', status: 'Not Scanned', presentDays: 35, attendanceDate: null }
        };
        
        function saveStudentsData() {
            localStorage.setItem('studentsData', JSON.stringify(studentsData));
        }

        // Blocked students data
        let blockedStudents = JSON.parse(localStorage.getItem('blockedStudents') || '{}');

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active', 'bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white');
                link.classList.add('text-gray-700', 'glass-button');
            });
            
            document.getElementById(sectionId).classList.remove('hidden');
            if (event && event.target) {
                event.target.classList.add('active', 'bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white');
                event.target.classList.remove('text-gray-700', 'glass-button');
            }
            
            if (sectionId === 'blocked') {
                renderBlockedStudentsList();
                updateBlockedStats();
            } else if (sectionId === 'dashboard') {
                updateAttendanceChart();
            } else if (sectionId === 'students') {
                renderAllStudentsList();
            } else if (sectionId === 'qr-scanner') {
                updateScannerStats();
                renderRecentScans();
            }
        }

        // Chart initialization
        let attendanceChart;
        
        function updateAttendanceChart() {
            const ctx = document.getElementById('attendanceChart');
            if (!ctx) return;
            
            if (attendanceChart) {
                attendanceChart.destroy();
                attendanceChart = null;
            }
            
            // Get real current data
            const totalStudents = Object.keys(studentsData).length;
            const presentToday = Object.values(studentsData).filter(s => s.status === 'Present').length;
            const lateToday = Object.values(studentsData).filter(s => s.status === 'Late').length;
            const absentToday = Object.values(studentsData).filter(s => s.status === 'Absent').length;
            
            // Generate realistic week data with today's actual data
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            const todayIndex = today.getDay() === 0 ? 6 : today.getDay() - 1; // Convert to Mon=0, Tue=1, etc.
            
            // Calculate current week's Monday
            const currentWeekMonday = new Date(today);
            currentWeekMonday.setDate(today.getDate() - todayIndex);
            
            // Calculate week end (Saturday)
            const currentWeekSaturday = new Date(currentWeekMonday);
            currentWeekSaturday.setDate(currentWeekMonday.getDate() + 5);
            
            // Update date range display
            const dateRange = `${currentWeekMonday.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}-${currentWeekSaturday.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
            const chartDateElement = document.getElementById('chart-date-range');
            if (chartDateElement) {
                chartDateElement.textContent = dateRange;
            }
            
            // Use real data for today, simulate past days with realistic patterns
            const presentData = days.map((day, index) => {
                if (index === todayIndex) {
                    return presentToday; // Today's actual present count
                } else if (index > todayIndex) {
                    return 0; // Future days - no data
                } else {
                    // Past days - simulate based on today's pattern
                    const baseRate = presentToday / totalStudents;
                    const variation = (Math.random() - 0.5) * 0.2; // Â±10% variation
                    return Math.max(0, Math.floor(totalStudents * (baseRate + variation)));
                }
            });
            
            const lateData = days.map((day, index) => {
                if (index === todayIndex) {
                    return lateToday; // Today's actual late count
                } else if (index > todayIndex) {
                    return 0; // Future days - no data
                } else {
                    // Past days - simulate based on today's pattern
                    const baseRate = lateToday / totalStudents;
                    const variation = (Math.random() - 0.5) * 0.1; // Â±5% variation
                    return Math.max(0, Math.floor(totalStudents * (baseRate + variation)));
                }
            });
            
            const absentData = days.map((day, index) => {
                if (index === todayIndex) {
                    return absentToday; // Today's actual absent count
                } else if (index > todayIndex) {
                    return totalStudents; // Future days - all absent
                } else {
                    return Math.max(0, totalStudents - presentData[index] - lateData[index]); // Past days - remaining students
                }
            });
            
            // Calculate real data
            const scannedToday = presentToday + lateToday;
            const attendanceRate = totalStudents > 0 ? Math.round((scannedToday / totalStudents) * 100) : 0;
            
            console.log('Chart Data:', { presentToday, lateToday, absentToday, totalStudents, attendanceRate });
            
            attendanceChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Present',
                        data: presentData,
                        backgroundColor: 'rgba(34, 197, 94, 0.8)',
                        borderColor: '#22c55e',
                        borderWidth: 0,
                        borderRadius: 8,
                        borderSkipped: false,
                    }, {
                        label: 'Late',
                        data: lateData,
                        backgroundColor: 'rgba(251, 191, 36, 0.8)',
                        borderColor: '#f59e0b',
                        borderWidth: 0,
                        borderRadius: 8,
                        borderSkipped: false,
                    }, {
                        label: 'Absent',
                        data: absentData,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: '#ef4444',
                        borderWidth: 0,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#374151',
                            bodyColor: '#6b7280',
                            borderColor: 'rgba(0, 0, 0, 0.1)',
                            borderWidth: 1,
                            cornerRadius: 12,
                            displayColors: true,
                            padding: 12
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            border: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: Math.max(totalStudents + 10, 50),
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: false
                            },
                            border: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 11
                                },
                                stepSize: Math.max(Math.floor(totalStudents / 10), 5)
                            }
                        }
                    },
                    elements: {
                        bar: {
                            borderWidth: 0
                        }
                    }
                }
            });
            
            // Update legend and stats after chart creation
            setTimeout(() => {
                const legendPresent = document.getElementById('legend-present');
                const legendLate = document.getElementById('legend-late');
                const legendAbsent = document.getElementById('legend-absent');
                const weekAvg = document.getElementById('week-avg');
                const bestDayRate = document.getElementById('best-day-rate');
                const totalScannedEl = document.getElementById('total-scanned');
                const remainingAbsentEl = document.getElementById('remaining-absent');
                
                if (legendPresent) legendPresent.textContent = presentToday;
                if (legendLate) legendLate.textContent = lateToday;
                if (legendAbsent) legendAbsent.textContent = absentToday;
                if (weekAvg) weekAvg.textContent = attendanceRate + '%';
                if (bestDayRate) bestDayRate.textContent = attendanceRate + '%';
                if (totalScannedEl) totalScannedEl.textContent = scannedToday;
                if (remainingAbsentEl) remainingAbsentEl.textContent = absentToday;
            }, 100);
        }

        // Blocked students functions
        function saveBlockedStudents() {
            localStorage.setItem('blockedStudents', JSON.stringify(blockedStudents));
        }

        function updateBlockedStats() {
            const totalStudents = Object.keys(studentsData).length;
            const blockedCount = Object.keys(blockedStudents).filter(id => blockedStudents[id]).length;
            const activeCount = totalStudents - blockedCount;
            
            document.getElementById('blocked-count').textContent = blockedCount;
            document.getElementById('active-count').textContent = activeCount;
            document.getElementById('total-students').textContent = totalStudents;
            
            // Update dashboard stats
            updateDashboardStats();
        }
        
        function updateDashboardStats() {
            const totalStudents = Object.keys(studentsData).length;
            const presentToday = Object.values(studentsData).filter(s => s.status === 'Present').length;
            const lateToday = Object.values(studentsData).filter(s => s.status === 'Late').length;
            const absentToday = Object.values(studentsData).filter(s => s.status === 'Absent').length;
            const scannedToday = presentToday + lateToday;
            const attendanceRate = totalStudents > 0 ? Math.round((scannedToday / totalStudents) * 100) : 0;
            
            // Update dashboard cards
            const totalEl = document.getElementById('total-students');
            const presentEl = document.getElementById('present-today');
            const absentEl = document.getElementById('absent-today');
            const rateEl = document.getElementById('attendance-rate');
            const onTimeEl = document.getElementById('on-time-count');
            const lateEl = document.getElementById('late-count');
            const absentCountEl = document.getElementById('absent-count');
            
            if (totalEl) totalEl.textContent = totalStudents;
            if (presentEl) presentEl.textContent = scannedToday; // Present + Late = Scanned
            if (absentEl) absentEl.textContent = absentToday; // Absent students
            if (rateEl) rateEl.textContent = attendanceRate + '%';
            if (onTimeEl) onTimeEl.textContent = presentToday;
            if (lateEl) lateEl.textContent = lateToday;
            if (absentCountEl) absentCountEl.textContent = absentToday;
        }

        function renderBlockedStudentsList(searchTerm = '') {
            const tbody = document.getElementById('blocked-students-list');
            if (!tbody) return;
            
            let html = '';
            let currentClass = null;
            
            // Sort students by class number and filter by search term
            const sortedStudents = Object.keys(studentsData)
                .filter(studentId => {
                    if (!searchTerm) return true;
                    const student = studentsData[studentId];
                    return student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           studentId.toLowerCase().includes(searchTerm.toLowerCase());
                })
                .sort((a, b) => {
                    const classA = parseInt(studentsData[a].class);
                    const classB = parseInt(studentsData[b].class);
                    return classA - classB;
                });
            
            sortedStudents.forEach(studentId => {
                const student = studentsData[studentId];
                const isBlocked = blockedStudents[studentId] || false;
                const statusColor = isBlocked ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800';
                const statusText = isBlocked ? 'Blocked' : 'Active';
                const actionButton = isBlocked ? 
                    `<button onclick="unblockStudent('${studentId}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm">Unblock</button>` :
                    `<button onclick="blockStudent('${studentId}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm">Block</button>`;
                
                const initials = student.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                // Add class separator with line
                if (currentClass !== student.class) {
                    if (currentClass !== null) {
                        // Add separating line between classes
                        html += `<tr><td colspan="6" class="border-t-2 border-gray-300 py-2"></td></tr>`;
                    }
                    // Add class header
                    html += `
                        <tr class="bg-gray-100">
                            <td colspan="6" class="px-6 py-3 text-sm font-bold text-gray-700 uppercase tracking-wide">
                                Class ${student.class} Students
                            </td>
                        </tr>
                    `;
                    currentClass = student.class;
                }
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-8 h-8 ${isBlocked ? 'bg-red-500' : 'bg-blue-500'} rounded-full flex items-center justify-center text-white text-sm font-medium">
                                    ${initials}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${student.name}</div>
                                    <div class="text-sm text-gray-500">${student.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">${studentId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Class ${student.class}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium ${getStatusColor(student.status)} rounded-full">${student.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium ${statusColor} rounded-full">${statusText}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            ${actionButton}
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function getStatusColor(status) {
            switch(status) {
                case 'Present': return 'bg-green-100 text-green-800';
                case 'Late': return 'bg-yellow-100 text-yellow-800';
                case 'Absent': return 'bg-red-100 text-red-800';
                case 'Not Scanned': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }
        
        function updateClassAttendanceRates() {
            // Update class boxes with real-time attendance rates
            for (let classNum = 1; classNum <= 12; classNum++) {
                const classStudents = Object.values(studentsData).filter(s => s.class === classNum.toString());
                const totalInClass = classStudents.length;
                const presentInClass = classStudents.filter(s => s.status === 'Present' || s.status === 'Late').length;
                const attendanceRate = totalInClass > 0 ? Math.round((presentInClass / totalInClass) * 100) : 0;
                
                // Update the class box display if it exists
                const classBox = document.querySelector(`[onclick="showClassStudents('${classNum}')"]`);
                if (classBox) {
                    const studentCountText = classBox.querySelector('.text-sm.font-semibold');
                    const progressBar = classBox.querySelector('.bg-blue-500, .bg-green-500, .bg-purple-500, .bg-red-500, .bg-yellow-500, .bg-indigo-500, .bg-pink-500, .bg-teal-500, .bg-orange-500, .bg-cyan-500');
                    const percentageText = classBox.querySelector('.text-xs');
                    
                    if (studentCountText) {
                        studentCountText.textContent = `${totalInClass} Students`;
                    }
                    if (progressBar) {
                        progressBar.style.width = attendanceRate + '%';
                    }
                    if (percentageText) {
                        percentageText.textContent = attendanceRate + '% Today';
                    }
                }
            }
        }

        function blockStudent(studentId) {
            showPasswordModal(`Enter password to block ${studentsData[studentId].name}:`, 'block', studentId);
        }

        function unblockStudent(studentId) {
            showPasswordModal(`Enter password to unblock ${studentsData[studentId].name}:`, 'unblock', studentId);
        }

        function blockAllStudents() {
            showPasswordModal('Enter password to block all students:', 'blockAll');
        }

        function unblockAllStudents() {
            showPasswordModal('Enter password to unblock all students:', 'unblockAll');
        }
        
        function searchStudents() {
            const searchTerm = document.getElementById('student-search').value;
            renderBlockedStudentsList(searchTerm);
        }
        
        function clearSearch() {
            document.getElementById('student-search').value = '';
            renderBlockedStudentsList();
        }
        
        function searchStudentsMenu() {
            const searchTerm = document.getElementById('student-menu-search').value;
            renderAllStudentsList(searchTerm);
        }
        
        function clearStudentSearch() {
            document.getElementById('student-menu-search').value = '';
            renderAllStudentsList();
        }
        
        let isMenuLocked = false;
        let isStudentMenuLocked = false;
        
        function toggleLock() {
            if (isMenuLocked) {
                showPasswordModal('Enter password to unlock menu:', 'unlockMenu');
            } else {
                showPasswordModal('Enter password to lock menu:', 'lockMenu');
            }
        }
        
        function toggleStudentLock() {
            if (isStudentMenuLocked) {
                showPasswordModal('Enter password to unlock student menu:', 'unlockStudentMenu');
            } else {
                showPasswordModal('Enter password to lock student menu:', 'lockStudentMenu');
            }
        }
        
        function lockMenu() {
            isMenuLocked = true;
            const lockBtn = document.getElementById('lock-btn');
            const lockText = document.getElementById('lock-text');
            
            lockBtn.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9))';
            lockBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i><span>Unlock Menu</span>';
            
            // Disable all navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                if (!link.onclick.toString().includes('qr-scanner')) {
                    link.style.pointerEvents = 'none';
                    link.style.opacity = '0.5';
                }
            });
            
            lucide.createIcons();
            alert('Menu locked! Only QR Scanner accessible.');
        }
        
        function unlockMenu() {
            isMenuLocked = false;
            const lockBtn = document.getElementById('lock-btn');
            
            lockBtn.style.background = 'linear-gradient(135deg, rgba(107, 114, 128, 0.9), rgba(75, 85, 99, 0.9))';
            lockBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i><span>Lock Menu</span>';
            
            // Enable all navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.style.pointerEvents = 'auto';
                link.style.opacity = '1';
            });
            
            lucide.createIcons();
            alert('Menu unlocked! All sections accessible.');
        }
        
        function lockStudentMenu() {
            isStudentMenuLocked = true;
            const lockBtn = document.getElementById('student-lock-btn');
            
            lockBtn.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9))';
            lockBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i><span>Unlock Menu</span>';
            
            // Disable all navigation links except students
            document.querySelectorAll('.nav-link').forEach(link => {
                if (!link.onclick.toString().includes('students')) {
                    link.style.pointerEvents = 'none';
                    link.style.opacity = '0.5';
                }
            });
            
            // Hide student directory
            const studentDirectory = document.getElementById('all-students-list').closest('.rounded-2xl');
            if (studentDirectory) {
                studentDirectory.style.display = 'none';
            }
            
            lucide.createIcons();
            alert('Student menu locked! Only adding students allowed.');
        }
        
        function unlockStudentMenu() {
            isStudentMenuLocked = false;
            const lockBtn = document.getElementById('student-lock-btn');
            
            lockBtn.style.background = 'linear-gradient(135deg, rgba(107, 114, 128, 0.9), rgba(75, 85, 99, 0.9))';
            lockBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i><span>Lock Menu</span>';
            
            // Enable all navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.style.pointerEvents = 'auto';
                link.style.opacity = '1';
            });
            
            // Show student directory
            const studentDirectory = document.getElementById('all-students-list').closest('.rounded-2xl');
            if (studentDirectory) {
                studentDirectory.style.display = 'block';
            }
            
            lucide.createIcons();
            alert('Student menu unlocked! All functions accessible.');
        }
        
        let editingStudentId = null;
        
        function editStudent(studentId) {
            if (isStudentMenuLocked) {
                alert('Student menu is locked! Only adding students is allowed.');
                return;
            }
            
            editingStudentId = studentId;
            const student = studentsData[studentId];
            
            document.getElementById('edit-name').value = student.name;
            document.getElementById('edit-class').value = student.class;
            document.getElementById('edit-section').value = student.section;
            document.getElementById('edit-email').value = student.email;
            
            document.getElementById('edit-student-modal').classList.remove('hidden');
        }
        
        function closeEditStudentModal() {
            document.getElementById('edit-student-modal').classList.add('hidden');
            editingStudentId = null;
        }
        
        function saveEditStudent() {
            if (!editingStudentId) return;
            
            const name = document.getElementById('edit-name').value.trim();
            const className = document.getElementById('edit-class').value;
            const section = document.getElementById('edit-section').value;
            const email = document.getElementById('edit-email').value.trim();
            
            if (!name || !className || !section || !email) {
                alert('Please fill all fields');
                return;
            }
            
            studentsData[editingStudentId].name = name;
            studentsData[editingStudentId].class = className;
            studentsData[editingStudentId].section = section.toUpperCase();
            studentsData[editingStudentId].email = email;
            
            saveStudentsData();
            const searchTerm = document.getElementById('student-menu-search').value;
            renderAllStudentsList(searchTerm);
            updateAllDisplays();
            updateClassAttendanceRates();
            closeEditStudentModal();
            alert('Student updated successfully!');
        }
        
        function deleteStudent(studentId) {
            if (isStudentMenuLocked) {
                alert('Student menu is locked! Only adding students is allowed.');
                return;
            }
            
            const student = studentsData[studentId];
            if (confirm(`Delete ${student.name} (${studentId})? This action cannot be undone.`)) {
                delete studentsData[studentId];
                delete blockedStudents[studentId];
                saveStudentsData();
                saveBlockedStudents();
                const searchTerm = document.getElementById('student-menu-search').value;
                renderAllStudentsList(searchTerm);
                updateAllDisplays();
                updateClassAttendanceRates();
                alert('Student deleted successfully!');
            }
        }
        
        function enableScanner() {
            const scannerBtn = document.getElementById('scanner-btn');
            const manualInput = document.getElementById('manual-scan');
            const statusText = document.getElementById('scanner-status-text');
            
            scannerBtn.disabled = false;
            scannerBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            scannerBtn.classList.add('hover:scale-105');
            scannerBtn.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9))';
            scannerBtn.innerHTML = '<i data-lucide="scan-line" class="w-4 h-4 inline mr-2"></i>Activate Scanner';
            
            manualInput.disabled = false;
            manualInput.classList.remove('bg-gray-100', 'text-gray-500', 'cursor-not-allowed');
            manualInput.placeholder = 'Or enter student ID manually (e.g., HCS1001)';
            manualInput.onkeypress = handleManualScan;
            
            // Update scanner status
            if (statusText) {
                statusText.textContent = 'Ready';
                statusText.className = 'text-xl font-bold text-blue-600';
            }
            
            lucide.createIcons();
        }
        
        function disableScanner() {
            const scannerBtn = document.getElementById('scanner-btn');
            const manualInput = document.getElementById('manual-scan');
            const statusText = document.getElementById('scanner-status-text');
            
            stopScanner();
            
            scannerBtn.disabled = true;
            scannerBtn.classList.add('opacity-50', 'cursor-not-allowed');
            scannerBtn.classList.remove('hover:scale-105');
            scannerBtn.style.background = 'linear-gradient(135deg, rgba(107, 114, 128, 0.9), rgba(75, 85, 99, 0.9))';
            scannerBtn.innerHTML = '<i data-lucide="scan-line" class="w-4 h-4 inline mr-2"></i>Scanner Disabled - Start Timer First';
            
            manualInput.disabled = true;
            manualInput.classList.add('bg-gray-100', 'text-gray-500', 'cursor-not-allowed');
            manualInput.placeholder = 'Scanner disabled - Start timer first';
            manualInput.value = '';
            manualInput.onkeypress = null;
            
            // Update scanner status
            if (statusText) {
                statusText.textContent = 'Disabled';
                statusText.className = 'text-xl font-bold text-gray-600';
            }
            
            lucide.createIcons();
        }
        
        let currentAction = null;
        let currentStudentId = null;
        
        function showPasswordModal(message, actionType, studentId = null) {
            document.getElementById('password-message').textContent = message;
            document.getElementById('password-input').value = '';
            document.getElementById('password-modal').classList.remove('hidden');
            document.getElementById('password-input').focus();
            currentAction = actionType;
            currentStudentId = studentId;
        }
        
        function closePasswordModal() {
            document.getElementById('password-modal').classList.add('hidden');
            currentAction = null;
            currentStudentId = null;
        }
        
        function verifyPassword() {
            const password = document.getElementById('password-input').value;
            let correctPassword = appSettings.timerPassword; // default
            
            // Determine which password to check based on action
            if (currentAction === 'changePasswordAuth') {
                correctPassword = '6666'; // Master password for changing passwords
            } else if (currentAction === 'openSettings') {
                correctPassword = '6073'; // Settings access password
            } else if (currentAction === 'block' || currentAction === 'unblock' || currentAction === 'blockAll' || currentAction === 'unblockAll') {
                correctPassword = appSettings.blockPassword;
            } else if (currentAction === 'lockMenu' || currentAction === 'unlockMenu') {
                correctPassword = appSettings.lockPassword;
            } else if (currentAction === 'startAttendanceTimer' || currentAction === 'startAbsentTimer') {
                correctPassword = appSettings.timerPassword;
            }
            
            if (password === correctPassword) {
                const action = currentAction;
                const studentId = currentStudentId;
                closePasswordModal();
                
                if (action === 'block' && studentId) {
                    if (confirm(`Block ${studentsData[studentId].name}? They will not be able to scan QR codes.`)) {
                        blockedStudents[studentId] = true;
                        saveBlockedStudents();
                        renderBlockedStudentsList();
                        updateBlockedStats();
                        alert(`${studentsData[studentId].name} has been blocked.`);
                    }
                } else if (action === 'unblock' && studentId) {
                    if (confirm(`Unblock ${studentsData[studentId].name}? They will be able to scan QR codes again.`)) {
                        delete blockedStudents[studentId];
                        saveBlockedStudents();
                        renderBlockedStudentsList();
                        updateBlockedStats();
                        alert(`${studentsData[studentId].name} has been unblocked.`);
                    }
                } else if (action === 'blockAll') {
                    if (confirm('Block ALL students?')) {
                        Object.keys(studentsData).forEach(id => blockedStudents[id] = true);
                        saveBlockedStudents();
                        renderBlockedStudentsList();
                        updateBlockedStats();
                        alert('All students blocked.');
                    }
                } else if (action === 'unblockAll') {
                    if (confirm('Unblock ALL students?')) {
                        blockedStudents = {};
                        saveBlockedStudents();
                        renderBlockedStudentsList();
                        updateBlockedStats();
                        alert('All students unblocked.');
                    }
                } else if (action === 'startAttendanceTimer') {
                    executeAttendanceTimer();
                } else if (action === 'startAbsentTimer') {
                    executeAbsentTimer();
                } else if (action === 'lockMenu') {
                    lockMenu();
                } else if (action === 'unlockMenu') {
                    unlockMenu();
                } else if (action === 'changePasswordAuth') {
                    showChangePasswordModal(changingPasswordType);
                } else if (action === 'openSettings') {
                    showSection('settings');
                } else if (action === 'lockStudentMenu') {
                    lockStudentMenu();
                } else if (action === 'unlockStudentMenu') {
                    unlockStudentMenu();
                }
            } else {
                alert('Incorrect password!');
                document.getElementById('password-input').value = '';
                document.getElementById('password-input').focus();
            }
        }
        
        function executeAction() {
            if (currentAction === 'block' && currentStudentId) {
                if (confirm(`Block ${studentsData[currentStudentId].name}? They will not be able to scan QR codes.`)) {
                    blockedStudents[currentStudentId] = true;
                    saveBlockedStudents();
                    const searchTerm = document.getElementById('student-search').value;
                    renderBlockedStudentsList(searchTerm);
                    updateBlockedStats();
                    alert(`${studentsData[currentStudentId].name} has been blocked from scanning.`);
                }
            } else if (currentAction === 'unblock' && currentStudentId) {
                if (confirm(`Unblock ${studentsData[currentStudentId].name}? They will be able to scan QR codes again.`)) {
                    delete blockedStudents[currentStudentId];
                    saveBlockedStudents();
                    const searchTerm = document.getElementById('student-search').value;
                    renderBlockedStudentsList(searchTerm);
                    updateBlockedStats();
                    alert(`${studentsData[currentStudentId].name} has been unblocked.`);
                }
            } else if (currentAction === 'blockAll') {
                if (confirm('Block ALL students? This will prevent all students from scanning QR codes.')) {
                    Object.keys(studentsData).forEach(studentId => {
                        blockedStudents[studentId] = true;
                    });
                    saveBlockedStudents();
                    const searchTerm = document.getElementById('student-search').value;
                    renderBlockedStudentsList(searchTerm);
                    updateBlockedStats();
                    alert('All students have been blocked.');
                }
            } else if (currentAction === 'unblockAll') {
                if (confirm('Unblock ALL students? This will allow all students to scan QR codes.')) {
                    blockedStudents = {};
                    saveBlockedStudents();
                    const searchTerm = document.getElementById('student-search').value;
                    renderBlockedStudentsList(searchTerm);
                    updateBlockedStats();
                    alert('All students have been unblocked.');
                }
            }
        }
        
        function handlePasswordEnter(event) {
            if (event.key === 'Enter') {
                verifyPassword();
            }
        }
        
        // Additional functionality
        function showAddStudent() {
            document.getElementById('add-student-modal').classList.remove('hidden');
        }
        
        function closeAddStudentModal() {
            document.getElementById('add-student-modal').classList.add('hidden');
            document.getElementById('add-student-form').reset();
        }
        
        function addNewStudent() {
            const form = document.getElementById('add-student-form');
            const formData = new FormData(form);
            
            const name = formData.get('name');
            const className = formData.get('class');
            const section = formData.get('section');
            const email = formData.get('email');
            
            if (!name || !className || !section || !email) {
                alert('Please fill all fields');
                return;
            }
            
            // Generate new student ID
            const classNum = className.padStart(2, '0');
            const existingIds = Object.keys(studentsData).filter(id => id.startsWith(`HCS${classNum}`));
            const nextNum = (existingIds.length + 1).toString().padStart(2, '0');
            const newId = `HCS${classNum}${nextNum}`;
            
            // Add new student
            studentsData[newId] = {
                name: name,
                email: email,
                class: className,
                section: section.toUpperCase(),
                attendance: '100%',
                status: 'Present',
                presentDays: 0,
                attendanceDate: null
            };
            
            saveStudentsData();
            renderAllStudentsList();
            updateBlockedStats();
            updateAttendanceChart();
            updateClassAttendanceRates();
            closeAddStudentModal();
            alert(`Student ${name} (${newId}) added successfully!`);
        }
        
        function showClassStudents(classNum) {
            const tbody = document.getElementById('all-students-list');
            if (!tbody) return;
            
            let html = '';
            
            // Filter students by selected class
            const classStudents = Object.keys(studentsData).filter(id => studentsData[id].class === classNum);
            
            // Add class header
            html += `
                <tr class="bg-blue-100">
                    <td colspan="6" class="px-6 py-3 text-sm font-bold text-blue-700 uppercase tracking-wide">
                        Class ${classNum} Students (${classStudents.length} students)
                    </td>
                </tr>
            `;
            
            classStudents.forEach(studentId => {
                const student = studentsData[studentId];
                const initials = student.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                    ${initials}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${student.name}</div>
                                    <div class="text-sm text-gray-500">${student.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">${studentId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Class ${student.class}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.section}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.attendance}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium ${getStatusColor(student.status)} rounded-full">${student.status}</span>
                        </td>
                    </tr>
                `;
            });
            
            // Add button to show all students again
            html += `
                <tr class="bg-gray-50">
                    <td colspan="6" class="px-6 py-3 text-center">
                        <button onclick="renderAllStudentsList()" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                            Show All Students
                        </button>
                    </td>
                </tr>
            `;
            
            tbody.innerHTML = html;
        }
        
        function renderAllStudentsList(searchTerm = '') {
            const tbody = document.getElementById('all-students-list');
            if (!tbody) return;
            
            let html = '';
            let currentClass = null;
            
            // Sort students by class number and filter by search term
            const sortedStudents = Object.keys(studentsData)
                .filter(studentId => {
                    if (!searchTerm) return true;
                    const student = studentsData[studentId];
                    return student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           studentId.toLowerCase().includes(searchTerm.toLowerCase());
                })
                .sort((a, b) => {
                    const classA = parseInt(studentsData[a].class);
                    const classB = parseInt(studentsData[b].class);
                    return classA - classB;
                });
            
            sortedStudents.forEach(studentId => {
                const student = studentsData[studentId];
                const initials = student.name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                // Add class separator
                if (currentClass !== student.class) {
                    if (currentClass !== null) {
                        html += `<tr><td colspan="6" class="border-t-2 border-gray-300"></td></tr>`;
                    }
                    html += `
                        <tr class="bg-gray-100">
                            <td colspan="6" class="px-6 py-3 text-sm font-bold text-gray-700 uppercase tracking-wide">
                                Class ${student.class}
                            </td>
                        </tr>
                    `;
                    currentClass = student.class;
                }
                
                // Get current status
                const currentStatus = student.status || 'Absent';
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                    ${initials}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${student.name}</div>
                                    <div class="text-sm text-gray-500">${student.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">${studentId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Class ${student.class}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.section}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.attendance}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium ${getStatusColor(currentStatus)} rounded-full">${currentStatus}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="editStudent('${studentId}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs">
                                    Edit
                                </button>
                                <button onclick="deleteStudent('${studentId}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-xs">
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        let absentTimerInterval;
        let attendanceTimerInterval;
        
        function startTimer() {
            showPasswordModal('Enter password to start attendance timer:', 'startAttendanceTimer');
        }
        
        function executeAttendanceTimer() {
            const minutes = parseInt(document.getElementById('timer-minutes').value) || 0;
            const seconds = parseInt(document.getElementById('timer-seconds').value) || 0;
            const totalSeconds = minutes * 60 + seconds;
            
            if (totalSeconds <= 0) {
                alert('Please set a valid time');
                return;
            }
            
            timerActive = true;
            enableScanner();
            
            let remainingTime = totalSeconds;
            const display = document.getElementById('attendance-timer-display');
            const button = document.getElementById('attendance-timer-btn');
            
            display.classList.remove('hidden');
            button.textContent = 'Timer Running...';
            button.disabled = true;
            button.classList.add('opacity-50');
            document.getElementById('attendance-stop-btn').classList.remove('hidden');
            
            attendanceTimerInterval = setInterval(() => {
                const mins = Math.floor(remainingTime / 60);
                const secs = remainingTime % 60;
                display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                if (remainingTime <= 0) {
                    clearInterval(attendanceTimerInterval);
                    timerActive = false;
                    disableScanner();
                    markNonPresentAsLate();
                    display.textContent = 'Timer Ended!';
                    button.textContent = 'Start Attendance Timer';
                    button.disabled = false;
                    button.classList.remove('opacity-50');
                    document.getElementById('attendance-stop-btn').classList.add('hidden');
                    alert('Attendance timer ended! Non-present students marked as Late.');
                    setTimeout(() => {
                        display.classList.add('hidden');
                    }, 3000);
                }
                
                remainingTime--;
            }, 1000);
        }
        
        function startAbsentTimer() {
            showPasswordModal('Enter password to start absent timer:', 'startAbsentTimer');
        }
        
        function executeAbsentTimer() {
            const minutes = parseInt(document.getElementById('absent-timer-minutes').value) || 0;
            const seconds = parseInt(document.getElementById('absent-timer-seconds').value) || 0;
            const totalSeconds = minutes * 60 + seconds;
            
            if (totalSeconds <= 0) {
                alert('Please set a valid time');
                return;
            }
            
            timerActive = true;
            enableScanner();
            
            let remainingTime = totalSeconds;
            const display = document.getElementById('absent-timer-display');
            const button = document.getElementById('absent-timer-btn');
            
            display.classList.remove('hidden');
            button.textContent = 'Timer Running...';
            button.disabled = true;
            button.classList.add('opacity-50');
            
            document.getElementById('absent-stop-btn').classList.remove('hidden');
            
            absentTimerInterval = setInterval(() => {
                const mins = Math.floor(remainingTime / 60);
                const secs = remainingTime % 60;
                display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                if (remainingTime <= 0) {
                    clearInterval(absentTimerInterval);
                    timerActive = false;
                    disableScanner();
                    markLateStudentsAbsent();
                    display.textContent = 'Timer Ended!';
                    button.textContent = 'Start Absent Timer';
                    button.disabled = false;
                    button.classList.remove('opacity-50');
                    document.getElementById('absent-stop-btn').classList.add('hidden');
                    setTimeout(() => {
                        display.classList.add('hidden');
                    }, 3000);
                }
                
                remainingTime--;
            }, 1000);
        }
        
        function markNonPresentAsLate() {
            let lateCount = 0;
            
            Object.keys(studentsData).forEach(studentId => {
                if (studentsData[studentId].status === 'Absent') {
                    studentsData[studentId].status = 'Late';
                    lateCount++;
                }
            });
            
            saveStudentsData();
            updateAllDisplays();
        }
        
        function markLateStudentsAbsent() {
            let notScannedCount = 0;
            
            Object.keys(studentsData).forEach(studentId => {
                if (studentsData[studentId].status === 'Late') {
                    studentsData[studentId].status = 'Absent';
                    notScannedCount++;
                }
            });
            
            saveStudentsData();
            updateAllDisplays();
            
            alert(`Timer ended! ${notScannedCount} late students marked as absent.`);
        }
        
        let scanHistory = JSON.parse(localStorage.getItem('scanHistory') || '[]');
        let sessionStartTime = null;
        let sessionTimerInterval = null;
        let isScanning = false;
        let scannerStream = null;
        let scannerInterval = null;
        let lastScannedCode = null;
        let scanCooldown = {};
        
        let timerActive = false;
        
        async function toggleScanner() {
            if (!timerActive) {
                alert('Please start a timer first to enable scanning.');
                return;
            }
            if (isScanning) {
                stopScanner();
            } else {
                await startScanner();
            }
        }
        
        async function startScanner() {
            try {
                const video = document.getElementById('scanner-video');
                const placeholder = document.getElementById('scanner-placeholder');
                const btn = document.getElementById('scanner-btn');
                const statusText = document.getElementById('scanner-status-text');
                
                // Enhanced camera constraints for better QR detection
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1920, min: 640 },
                        height: { ideal: 1080, min: 480 },
                        frameRate: { ideal: 30, min: 15 },
                        focusMode: 'continuous',
                        exposureMode: 'continuous',
                        whiteBalanceMode: 'continuous'
                    }
                };
                
                try {
                    scannerStream = await navigator.mediaDevices.getUserMedia(constraints);
                } catch (err) {
                    // Fallback to basic constraints if advanced ones fail
                    console.log('Advanced constraints failed, trying basic...');
                    scannerStream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'environment' } 
                    });
                }
                
                video.srcObject = scannerStream;
                video.setAttribute('playsinline', true);
                
                // Wait for video to be ready
                video.addEventListener('loadedmetadata', () => {
                    video.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    startQRDetection();
                });
                
                video.play();
                
                btn.innerHTML = '<i data-lucide="square" class="w-4 h-4 inline mr-2"></i>Stop Scanner';
                btn.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 127, 0.9))';
                
                // Update scanner status
                if (statusText) {
                    statusText.textContent = 'Active';
                    statusText.className = 'text-xl font-bold text-green-600';
                }
                
                isScanning = true;
                startSessionTimer();
                lucide.createIcons();
                
            } catch (error) {
                alert('Camera access denied or not available. Use manual input instead.');
                console.error('Camera error:', error);
            }
        }
        
        function stopScanner() {
            if (scannerStream) {
                scannerStream.getTracks().forEach(track => track.stop());
                scannerStream = null;
            }
            
            if (scannerInterval) {
                clearInterval(scannerInterval);
                scannerInterval = null;
            }
            
            const video = document.getElementById('scanner-video');
            const placeholder = document.getElementById('scanner-placeholder');
            const btn = document.getElementById('scanner-btn');
            const statusText = document.getElementById('scanner-status-text');
            
            video.classList.add('hidden');
            placeholder.classList.remove('hidden');
            
            btn.innerHTML = '<i data-lucide="scan-line" class="w-4 h-4 inline mr-2"></i>Activate Scanner';
            btn.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9))';
            
            // Update scanner status
            if (statusText) {
                statusText.textContent = 'Inactive';
                statusText.className = 'text-xl font-bold text-red-600';
            }
            
            isScanning = false;
            lucide.createIcons();
        }
        
        function startQRDetection() {
            const video = document.getElementById('scanner-video');
            const canvas = document.getElementById('scanner-canvas');
            const ctx = canvas.getContext('2d');
            
            scannerInterval = setInterval(() => {
                if (video.readyState === video.HAVE_ENOUGH_DATA) {
                    const vw = video.videoWidth;
                    const vh = video.videoHeight;
                    
                    if (vw > 0 && vh > 0) {
                        canvas.width = vw;
                        canvas.height = vh;
                        
                        // Clear canvas and draw with better quality
                        ctx.clearRect(0, 0, vw, vh);
                        ctx.imageSmoothingEnabled = false;
                        ctx.drawImage(video, 0, 0, vw, vh);
                        
                        // Get image data with better sampling
                        const imageData = ctx.getImageData(0, 0, vw, vh);
                        
                        // Try multiple detection attempts with different settings
                        let code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: 'dontInvert'
                        });
                        
                        // If not found, try with inversion
                        if (!code) {
                            code = jsQR(imageData.data, imageData.width, imageData.height, {
                                inversionAttempts: 'onlyInvert'
                            });
                        }
                        
                        // If still not found, try with both
                        if (!code) {
                            code = jsQR(imageData.data, imageData.width, imageData.height, {
                                inversionAttempts: 'attemptBoth'
                            });
                        }
                        
                        if (code && code.data) {
                            const qrData = code.data.trim();
                            // Validate QR code format before processing
                            if (qrData.match(/^HCS\d{4}$/)) {
                                // Check if same QR code is still in view
                                if (lastScannedCode === qrData) {
                                    return; // Same QR code still in camera, don't process again
                                }
                                
                                // Check cooldown period (3 seconds)
                                const now = Date.now();
                                if (scanCooldown[qrData] && (now - scanCooldown[qrData]) < 3000) {
                                    return; // Still in cooldown period
                                }
                                
                                lastScannedCode = qrData;
                                scanCooldown[qrData] = now;
                                processQRCode(qrData);
                            }
                        } else {
                            // No QR code detected, reset last scanned code
                            lastScannedCode = null;
                        }
                    }
                }
            }, 150);
        }
        
        function processQRCode(qrData) {
            // Extract student ID from QR code data
            let studentId = qrData.trim().toUpperCase();
            
            // Handle different QR code formats
            if (studentId.includes('HCS')) {
                const match = studentId.match(/HCS\d{4}/);
                if (match) {
                    studentId = match[0];
                }
            }
            
            markAttendance(studentId);
        }
        
        function handleManualScan(event) {
            if (!timerActive) {
                alert('Please start a timer first to enable scanning.');
                return;
            }
            if (event.key === 'Enter') {
                const input = event.target;
                const studentId = input.value.trim().toUpperCase();
                if (studentId) {
                    markAttendance(studentId);
                    input.value = '';
                }
            }
        }
        
        function markAttendance(studentId) {
            const now = new Date();
            const today = now.toDateString();
            const currentTime = Date.now();
            
            // Check if student exists
            if (!studentsData[studentId]) {
                showScanResult('Student not found: ' + studentId, 'error');
                return;
            }
            
            // Check if student is blocked
            if (blockedStudents[studentId]) {
                showScanResult('Student is blocked: ' + studentsData[studentId].name, 'error');
                return;
            }
            
            // Initialize scan count for today
            if (!studentsData[studentId].dailyScanCount || studentsData[studentId].lastScanDate !== today) {
                studentsData[studentId].dailyScanCount = 0;
                studentsData[studentId].lastScanDate = today;
            }
            
            // Increment scan count
            studentsData[studentId].dailyScanCount++;
            
            // First scan - mark attendance
            if (studentsData[studentId].dailyScanCount === 1) {
                // Continue with normal attendance marking
            }
            // Second scan - block student automatically
            else if (studentsData[studentId].dailyScanCount >= 2) {
                blockedStudents[studentId] = true;
                saveBlockedStudents();
                showScanResult('Student blocked for multiple scan attempts: ' + studentsData[studentId].name, 'error');
                saveStudentsData();
                updateBlockedStats();
                return;
            }
            
            // Determine status based on current timer and existing status
            let newStatus;
            let isAbsentTimerScan = false;
            
            if (absentTimerInterval && studentsData[studentId].status === 'Late') {
                // If student was late and scanning during absent timer, mark as present
                newStatus = 'Present';
                isAbsentTimerScan = true;
            } else if (absentTimerInterval) {
                // Scanning during absent timer
                const now = new Date();
                const currentHour = now.getHours();
                newStatus = currentHour >= 9 ? 'Late' : 'Present';
                isAbsentTimerScan = true;
            } else {
                // Normal logic - check time for late detection
                const now = new Date();
                const currentHour = now.getHours();
                const isLate = currentHour >= 9; // After 9 AM is considered late
                newStatus = isLate ? 'Late' : 'Present';
            }
            
            studentsData[studentId].status = newStatus;
            studentsData[studentId].attendanceDate = now.toDateString();
            studentsData[studentId].lastScanTime = currentTime;
            
            // Only increment present days on first successful scan
            if (studentsData[studentId].dailyScanCount === 1) {
                studentsData[studentId].presentDays = (studentsData[studentId].presentDays || 0) + 1;
                let attendanceRate = (studentsData[studentId].presentDays / appSettings.workingDays) * 100;
                
                // Apply 0.1% penalty if scanned during absent timer
                if (isAbsentTimerScan) {
                    attendanceRate -= 0.1;
                }
                
                studentsData[studentId].attendance = Math.max(0, attendanceRate).toFixed(1) + '%';
            }
            
            saveStudentsData();
            addScanToHistory(studentId, studentsData[studentId].name, newStatus);
            
            // Update all displays immediately
            updateAllDisplays();
            
            showScanResult(`${studentsData[studentId].name} marked ${newStatus}`, 'success');
        }
        
        function playSuccessSound() {
            // Create audio context and play beep sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create beep pattern: beep-beep-beep
                const beepTimes = [0, 0.2, 0.4];
                
                beepTimes.forEach(startTime => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(1500, audioContext.currentTime + startTime);
                    oscillator.type = 'square';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime + startTime);
                    gainNode.gain.linearRampToValueAtTime(1.0, audioContext.currentTime + startTime + 0.01);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + startTime + 0.15);
                    
                    oscillator.start(audioContext.currentTime + startTime);
                    oscillator.stop(audioContext.currentTime + startTime + 0.15);
                });
            } catch (error) {
                console.log('Audio not supported');
            }
        }
        
        function playBlockedSound() {
            // Create audio context and play error sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create long error buzz sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(1.0, audioContext.currentTime + 0.05);
                gainNode.gain.linearRampToValueAtTime(1.0, audioContext.currentTime + 0.8);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1.0);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1.0);
            } catch (error) {
                console.log('Audio not supported');
            }
        }
        
        function showScanResult(message, type) {
            const resultDiv = document.getElementById('scan-result');
            const messageDiv = document.getElementById('scan-message');
            
            messageDiv.textContent = message;
            
            // Set colors based on type
            if (type === 'success') {
                resultDiv.className = 'absolute inset-0 flex items-center justify-center bg-green-500 bg-opacity-90 text-white font-bold text-lg';
                playSuccessSound(); // Play sound on success
            } else if (type === 'warning') {
                resultDiv.className = 'absolute inset-0 flex items-center justify-center bg-yellow-500 bg-opacity-90 text-white font-bold text-lg';
                if (absentTimerInterval) {
                    playSuccessSound(); // Play sound during absent timer scanning
                }
            } else {
                resultDiv.className = 'absolute inset-0 flex items-center justify-center bg-red-500 bg-opacity-90 text-white font-bold text-lg';
                playBlockedSound(); // Play error sound for blocked students
            }
            
            resultDiv.classList.remove('hidden');
            
            setTimeout(() => {
                resultDiv.classList.add('hidden');
            }, 2000);
        }
        
        function startSessionTimer() {
            if (sessionTimerInterval) {
                clearInterval(sessionTimerInterval);
            }
            
            sessionStartTime = Date.now();
            sessionTimerInterval = setInterval(updateSessionTimer, 1000);
        }
        
        function updateSessionTimer() {
            if (!sessionStartTime) return;
            
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            const timerElement = document.getElementById('session-timer');
            if (timerElement) {
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        function updateScannerStats() {
            const totalStudents = Object.keys(studentsData).length;
            const presentCount = Object.values(studentsData).filter(s => s.status === 'Present').length;
            const lateCount = Object.values(studentsData).filter(s => s.status === 'Late').length;
            const absentCount = Object.values(studentsData).filter(s => s.status === 'Absent').length;
            const scannedCount = presentCount + lateCount;
            const scanRate = totalStudents > 0 ? Math.round((scannedCount / totalStudents) * 100) : 0;
            
            const scannedEl = document.getElementById('scanned-today');
            const rateEl = document.getElementById('scan-rate');
            const presentEl = document.getElementById('present-scanned');
            const lateEl = document.getElementById('late-scanned');
            const notScannedEl = document.getElementById('not-scanned');
            
            if (scannedEl) scannedEl.textContent = scannedCount;
            if (rateEl) rateEl.textContent = scanRate + '%';
            if (presentEl) presentEl.textContent = presentCount;
            if (lateEl) lateEl.textContent = lateCount;
            if (notScannedEl) notScannedEl.textContent = absentCount;
            
            // Start session timer if not already running and we're in scanner section
            if (!sessionTimerInterval && document.getElementById('qr-scanner') && !document.getElementById('qr-scanner').classList.contains('hidden')) {
                startSessionTimer();
            }
        }
        
        function addScanToHistory(studentId, studentName, status) {
            const scan = {
                id: studentId,
                name: studentName,
                status: status,
                time: new Date().toLocaleTimeString(),
                timestamp: Date.now()
            };
            
            scanHistory.unshift(scan);
            if (scanHistory.length > 10) scanHistory.pop();
            localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
            renderRecentScans();
        }
        
        function renderRecentScans() {
            const container = document.getElementById('recent-scans');
            if (scanHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="scan-line" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        <p class="text-sm">No recent scans</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            scanHistory.forEach(scan => {
                const statusColor = scan.status === 'Present' ? 'text-green-600' : 'text-yellow-600';
                const statusIcon = scan.status === 'Present' ? 'check-circle' : 'clock';
                
                html += `
                    <div class="flex items-center justify-between p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(15px);">
                        <div class="flex items-center">
                            <i data-lucide="${statusIcon}" class="w-4 h-4 ${statusColor} mr-3"></i>
                            <div>
                                <div class="font-medium text-gray-900 text-sm">${scan.name}</div>
                                <div class="text-xs text-gray-500">${scan.id}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs font-medium ${statusColor}">${scan.status}</div>
                            <div class="text-xs text-gray-500">${scan.time}</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            lucide.createIcons();
        }
        
        function simulateScan() {
            if (!timerActive) {
                alert('Please start a timer first to enable scanning.');
                return;
            }
            
            const availableStudents = Object.keys(studentsData).filter(id => 
                studentsData[id].status !== 'Present' && studentsData[id].status !== 'Late'
            );
            
            if (availableStudents.length === 0) {
                alert('All students have already been scanned!');
                return;
            }
            
            const randomStudent = availableStudents[Math.floor(Math.random() * availableStudents.length)];
            markAttendance(randomStudent);
        }
        
        function clearScanHistory() {
            if (confirm('Clear all scan history?')) {
                scanHistory = [];
                localStorage.removeItem('scanHistory');
                renderRecentScans();
            }
        }
        
        function stopAttendanceTimer() {
            if (attendanceTimerInterval) {
                clearInterval(attendanceTimerInterval);
                timerActive = false;
                disableScanner();
                const display = document.getElementById('attendance-timer-display');
                const button = document.getElementById('attendance-timer-btn');
                const stopBtn = document.getElementById('attendance-stop-btn');
                
                display.textContent = 'Timer Stopped!';
                button.textContent = 'Start Attendance Timer';
                button.disabled = false;
                button.classList.remove('opacity-50');
                stopBtn.classList.add('hidden');
                
                setTimeout(() => {
                    display.classList.add('hidden');
                }, 2000);
            }
        }
        
        function stopAbsentTimer() {
            if (absentTimerInterval) {
                clearInterval(absentTimerInterval);
                timerActive = false;
                disableScanner();
                const display = document.getElementById('absent-timer-display');
                const button = document.getElementById('absent-timer-btn');
                const stopBtn = document.getElementById('absent-stop-btn');
                
                display.textContent = 'Timer Stopped!';
                button.textContent = 'Start Absent Timer';
                button.disabled = false;
                button.classList.remove('opacity-50');
                stopBtn.classList.add('hidden');
                
                setTimeout(() => {
                    display.classList.add('hidden');
                }, 2000);
            }
        }
        
        function exportScanData() {
            const today = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const totalStudents = Object.keys(studentsData).length;
            const presentCount = Object.values(studentsData).filter(s => s.status === 'Present').length;
            const lateCount = Object.values(studentsData).filter(s => s.status === 'Late').length;
            const absentCount = Object.values(studentsData).filter(s => s.status === 'Absent').length;
            const attendanceRate = Math.round(((presentCount + lateCount) / totalStudents) * 100);
            
            let reportContent = `${'='.repeat(60)}\n`;
            reportContent += `                    HOLY CROSS SCHOOL\n`;
            reportContent += `                 DAILY ATTENDANCE REPORT\n`;
            reportContent += `                    ${today}\n`;
            reportContent += `${'='.repeat(60)}\n\n`;
            
            reportContent += `OVERALL SUMMARY:\n`;
            reportContent += `${'-'.repeat(30)}\n`;
            reportContent += `Total Students: ${totalStudents}\n`;
            reportContent += `Present: ${presentCount} (${Math.round((presentCount/totalStudents)*100)}%)\n`;
            reportContent += `Late: ${lateCount} (${Math.round((lateCount/totalStudents)*100)}%)\n`;
            reportContent += `Absent: ${absentCount} (${Math.round((absentCount/totalStudents)*100)}%)\n`;
            reportContent += `Overall Attendance Rate: ${attendanceRate}%\n\n`;
            
            // Group students by class
            for (let classNum = 1; classNum <= 12; classNum++) {
                const classStudents = Object.keys(studentsData)
                    .filter(id => studentsData[id].class === classNum.toString())
                    .sort((a, b) => studentsData[a].name.localeCompare(studentsData[b].name));
                
                if (classStudents.length === 0) continue;
                
                const classPresent = classStudents.filter(id => studentsData[id].status === 'Present').length;
                const classLate = classStudents.filter(id => studentsData[id].status === 'Late').length;
                const classAbsent = classStudents.filter(id => studentsData[id].status === 'Absent').length;
                const classRate = Math.round(((classPresent + classLate) / classStudents.length) * 100);
                
                reportContent += `CLASS ${classNum} ATTENDANCE REPORT:\n`;
                reportContent += `${'-'.repeat(40)}\n`;
                reportContent += `Total: ${classStudents.length} | Present: ${classPresent} | Late: ${classLate} | Absent: ${classAbsent} | Rate: ${classRate}%\n\n`;
                
                // Group by section within class
                const sections = ['A', 'B'];
                sections.forEach(section => {
                    const sectionStudents = classStudents.filter(id => studentsData[id].section === section);
                    if (sectionStudents.length === 0) return;
                    
                    reportContent += `  Section ${section}:\n`;
                    sectionStudents.forEach((studentId, index) => {
                        const student = studentsData[studentId];
                        const scanTime = (student.status === 'Present' || student.status === 'Late') ? 
                            (scanHistory.find(scan => scan.id === studentId)?.time || 'Scanned') : 'Not Scanned';
                        const statusSymbol = student.status === 'Present' ? 'âœ“' : student.status === 'Late' ? 'âš ' : 'âœ—';
                        
                        reportContent += `    ${index + 1}. ${student.name.padEnd(25)} ${studentId} [${statusSymbol} ${student.status.padEnd(7)}] ${scanTime}\n`;
                    });
                    reportContent += `\n`;
                });
                
                reportContent += `\n`;
            }
            
            reportContent += `${'='.repeat(60)}\n`;
            reportContent += `Report Generated: ${new Date().toLocaleString()}\n`;
            reportContent += `Generated by: Holy Cross Attendance System\n`;
            reportContent += `${'='.repeat(60)}\n`;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Attendance-Report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function generateQR() {
            const select = document.getElementById('student-select');
            const studentId = select.value;
            
            if (!studentId) {
                alert('Please select a student first');
                return;
            }
            
            const student = studentsData[studentId];
            if (!student) {
                alert('Student not found');
                return;
            }
            
            // Generate QR code using qrcode library
            const qr = qrcode(0, 'M');
            qr.addData(studentId);
            qr.make();
            
            const qrHtml = qr.createImgTag(6, 8);
            
            const currentDate = new Date().toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: 'numeric' });
            
            document.getElementById('qr-display').innerHTML = `
                <div id="qr-id-card" class="bg-white border border-gray-300 mx-auto" style="font-family: Arial, sans-serif; width: 500px; height: 320px;">
                    <!-- Blue Header -->
                    <div class="text-center text-white py-3" style="background: linear-gradient(135deg, #4F46E5, #3B82F6);">
                        <h1 class="text-lg font-bold mb-1">${appSettings.schoolName.toUpperCase()}</h1>
                        <div class="flex justify-between items-center px-4">
                            <h2 class="text-sm font-semibold">STUDENT ID CARD</h2>
                            <p class="text-xs opacity-90">Attendance Management System</p>
                        </div>
                    </div>
                    
                    <!-- Main Content -->
                    <div class="flex h-full">
                        <!-- QR Code Section -->
                        <div class="flex-shrink-0 p-4 flex flex-col justify-center items-center" style="width: 180px;">
                            ${qrHtml}
                            <p class="text-xs text-green-600 font-bold mt-2 text-center">SCAN FOR ATTENDANCE</p>
                        </div>
                        
                        <!-- Student Details Section -->
                        <div class="flex-1 p-4">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">STUDENT DETAILS</h3>
                            <div class="grid grid-cols-2 gap-3 text-sm mb-4">
                                <div><strong>Name:</strong> ${student.name}</div>
                                <div><strong>Student ID:</strong> ${studentId}</div>
                                <div><strong>Class:</strong> ${student.class}</div>
                                <div><strong>Section:</strong> ${student.section}</div>
                            </div>
                            
                            <!-- Instructions -->
                            <div class="text-xs text-gray-600 space-y-1 mb-3">
                                <div>â€¢ Show this card to mark attendance</div>
                                <div>â€¢ Keep this card safe and secure</div>
                                <div>â€¢ Generated: ${currentDate}</div>
                            </div>
                            
                            <!-- Footer -->
                            <div class="text-right">
                                <p class="text-xs text-gray-500 italic">Official student identification card</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function populateStudentSelect(classFilter = '') {
            const select = document.getElementById('student-select');
            if (!select) return;
            
            // Clear existing options except first
            select.innerHTML = '<option value="">Choose a student...</option>';
            
            // Filter and sort students
            const filteredStudents = Object.keys(studentsData).filter(studentId => {
                if (!classFilter) return true;
                return studentsData[studentId].class === classFilter;
            });
            
            const sortedStudents = filteredStudents.sort((a, b) => {
                const studentA = studentsData[a];
                const studentB = studentsData[b];
                const classA = parseInt(studentA.class);
                const classB = parseInt(studentB.class);
                
                if (classA !== classB) {
                    return classA - classB;
                }
                return studentA.name.localeCompare(studentB.name);
            });
            
            sortedStudents.forEach(studentId => {
                const student = studentsData[studentId];
                const option = document.createElement('option');
                option.value = studentId;
                option.textContent = `${student.name} (${studentId}) - Class ${student.class}`;
                select.appendChild(option);
            });
        }
        
        function filterStudents() {
            const classFilter = document.getElementById('class-filter').value;
            populateStudentSelect(classFilter);
        }
        
        function downloadQR() {
            const idCard = document.getElementById('qr-id-card');
            
            if (!idCard) {
                alert('Please generate a QR code first!');
                return;
            }
            
            const studentSelect = document.getElementById('student-select');
            const studentId = studentSelect.value;
            const student = studentsData[studentId];
            
            // Use html2canvas library (add to head if not present)
            if (typeof html2canvas === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = () => downloadIDCard(idCard, studentId, student);
                document.head.appendChild(script);
            } else {
                downloadIDCard(idCard, studentId, student);
            }
        }
        
        function downloadIDCard(idCard, studentId, student) {
            html2canvas(idCard, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = `ID_Card_${studentId}_${student.name.replace(/\s+/g, '_')}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(error => {
                console.error('Download failed:', error);
                alert('Download failed. Please try again or right-click on the ID card to save manually.');
            });
        }
        
        function printQR() {
            alert('QR code sent to printer!');
        }
        
        function exportData() {
            const data = JSON.stringify(studentsData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'attendance-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            studentsData = JSON.parse(e.target.result);
                            saveStudentsData();
                            alert('Data imported successfully!');
                        } catch (err) {
                            alert('Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function resetData() {
            if (confirm('Are you sure? This will delete all data.')) {
                localStorage.clear();
                location.reload();
            }
        }
        
        let appSettings = JSON.parse(localStorage.getItem('appSettings')) || {
            schoolName: 'Holy Cross School',
            academicYear: '2024-2025',
            timerPassword: '6073',
            blockPassword: '6073',
            lockPassword: '6073',
            workingDays: 200,
            totalHolidays: 50
        };
        
        function updateSchoolName() {
            appSettings.schoolName = document.getElementById('school-name').value;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            updateAppDisplay();
        }
        
        function updateAcademicYear() {
            appSettings.academicYear = document.getElementById('academic-year').value;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            updateAppDisplay();
        }
        
        function updateTimerPassword() {
            appSettings.timerPassword = document.getElementById('timer-password-setting').value;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            alert('Timer password updated!');
        }
        
        function updateBlockPassword() {
            appSettings.blockPassword = document.getElementById('block-password-setting').value;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            alert('Block student password updated!');
        }
        
        function updateLockPassword() {
            appSettings.lockPassword = document.getElementById('lock-password-setting').value;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            alert('Menu lock password updated!');
        }
        

        let changingPasswordType = null;
        
        function changePassword(type) {
            showPasswordModal('Enter master password to change password:', 'changePasswordAuth', null, type);
        }
        
        function showChangePasswordModal(type) {
            changingPasswordType = type;
            const title = `Change ${type.charAt(0).toUpperCase() + type.slice(1)} Password`;
            const message = `Enter new ${type} password:`;
            
            document.getElementById('change-password-title').textContent = title;
            document.getElementById('change-password-message').textContent = message;
            document.getElementById('new-password-input').value = '';
            document.getElementById('change-password-modal').classList.remove('hidden');
            document.getElementById('new-password-input').focus();
        }
        
        function closeChangePasswordModal() {
            document.getElementById('change-password-modal').classList.add('hidden');
            changingPasswordType = null;
        }
        
        function saveNewPassword() {
            const newPassword = document.getElementById('new-password-input').value.trim();
            if (!newPassword) {
                alert('Please enter a password');
                return;
            }
            
            if (changingPasswordType === 'timer') {
                appSettings.timerPassword = newPassword;
                document.getElementById('timer-password-setting').value = newPassword;
            } else if (changingPasswordType === 'block') {
                appSettings.blockPassword = newPassword;
                document.getElementById('block-password-setting').value = newPassword;
            } else if (changingPasswordType === 'lock') {
                appSettings.lockPassword = newPassword;
                document.getElementById('lock-password-setting').value = newPassword;
            }
            
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            closeChangePasswordModal();
            alert(`${changingPasswordType.charAt(0).toUpperCase() + changingPasswordType.slice(1)} password changed successfully!`);
        }
        
        function handleNewPasswordEnter(event) {
            if (event.key === 'Enter') {
                saveNewPassword();
            }
        }
        
        function openSettings() {
            showPasswordModal('Enter password to access settings:', 'openSettings');
        }
        
        function updateWorkingDays() {
            appSettings.workingDays = parseInt(document.getElementById('working-days').value) || 200;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            updateAttendancePercentages();
        }
        
        function updateHolidays() {
            appSettings.totalHolidays = parseInt(document.getElementById('total-holidays').value) || 50;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            updateAttendancePercentages();
        }
        
        function updateAttendancePercentages() {
            Object.keys(studentsData).forEach(studentId => {
                const student = studentsData[studentId];
                const attendanceRate = (student.presentDays / appSettings.workingDays) * 100;
                student.attendance = attendanceRate.toFixed(1) + '%';
            });
            saveStudentsData();
            updateAllDisplays();
        }
        
        function updateAppDisplay() {
            // Update school name in sidebar
            document.querySelector('h1').textContent = appSettings.schoolName;
            
            // Update academic year in sidebar
            document.querySelector('.text-sm.font-bold.text-gray-800').textContent = `Academic Year ${appSettings.academicYear}`;
        }
        
        function loadSettings() {
            document.getElementById('school-name').value = appSettings.schoolName;
            document.getElementById('academic-year').value = appSettings.academicYear;
            document.getElementById('timer-password-setting').value = appSettings.timerPassword;
            document.getElementById('block-password-setting').value = appSettings.blockPassword;
            document.getElementById('lock-password-setting').value = appSettings.lockPassword;
            document.getElementById('working-days').value = appSettings.workingDays;
            document.getElementById('total-holidays').value = appSettings.totalHolidays;
            updateAppDisplay();
        }

        // Floating shapes animation
        function createFloatingShapes() {
            const container = document.getElementById('floating-shapes');
            if (!container) return;
            
            for (let i = 0; i < 15; i++) {
                const shape = document.createElement('div');
                shape.className = Math.random() > 0.5 ? 'shape' : 'bubble';
                shape.style.left = Math.random() * 100 + '%';
                shape.style.width = shape.style.height = (Math.random() * 60 + 20) + 'px';
                shape.style.animationDelay = Math.random() * 20 + 's';
                shape.style.animationDuration = (Math.random() * 10 + 15) + 's';
                container.appendChild(shape);
            }
        }
        
        // Clock functions
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const dateString = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const clockElements = document.querySelectorAll('[id*="live-clock"]');
            const dateElements = document.querySelectorAll('[id*="live-date"]');
            
            clockElements.forEach(el => el && (el.textContent = timeString));
            dateElements.forEach(el => el && (el.textContent = dateString));
        }
        
        // Calendar functionality
        let currentDate = new Date();
        
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('calendar-month').textContent = 
                new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            let html = '';
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="p-2"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
                const attendance = Math.random() > 0.3 ? 'high' : 'low';
                const bgColor = isToday ? 'bg-blue-500 text-white' : 
                               attendance === 'high' ? 'hover:bg-green-50' : 'hover:bg-red-50';
                const indicator = attendance === 'high' ? 'bg-green-500' : 'bg-red-500';
                
                html += `
                    <div class="p-2 text-center cursor-pointer rounded ${bgColor} relative group">
                        <span class="font-medium">${day}</span>
                        <div class="w-1 h-1 ${indicator} rounded-full mx-auto mt-1 opacity-60"></div>
                    </div>
                `;
            }
            
            document.getElementById('calendar-days').innerHTML = html;
        }
        
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }
        
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
        
        function exportChart() {
            if (attendanceChart) {
                const link = document.createElement('a');
                link.download = 'attendance-chart.png';
                link.href = attendanceChart.toBase64Image();
                link.click();
            }
        }
        
        // Daily data management
        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastUpdate = localStorage.getItem('lastUpdateDate');
            
            if (lastUpdate !== today) {
                // Only reset status for students who haven't been scanned today
                Object.keys(studentsData).forEach(id => {
                    if (studentsData[id].attendanceDate !== today) {
                        studentsData[id].status = 'Absent';
                        studentsData[id].attendanceDate = null;
                    }
                });
                
                // Clear scan history for new day
                scanHistory = [];
                localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
                
                saveStudentsData();
                localStorage.setItem('lastUpdateDate', today);
                
                // Update all displays
                updateAllDisplays();
            }
        }
        
        function updateAllDisplays() {
            updateDashboardStats();
            updateScannerStats();
            updateBlockedStats();
            renderAllStudentsList();
            renderBlockedStudentsList();
            renderRecentScans();
            updateClassAttendanceRates();
            
            // Update chart last to ensure data is ready
            setTimeout(() => {
                updateAttendanceChart();
                lucide.createIcons();
            }, 100);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Force reset to show absent status
            localStorage.removeItem('lastUpdateDate');
            checkDailyReset();
            
            createFloatingShapes();
            updateClock();
            setInterval(updateClock, 1000);
            
            // Force immediate update to show current data
            setTimeout(() => {
                updateAllDisplays();
                renderCalendar();
                lucide.createIcons();
            }, 100);
            
            // Set up periodic updates every 30 seconds
            setInterval(updateAllDisplays, 30000);
            
            // Initialize scanner as disabled
            disableScanner();
            
            // Load settings
            loadSettings();
            
            // Reset attendance if not already done
            if (!localStorage.getItem('attendanceReset')) {
                resetAllAttendance();
                localStorage.setItem('attendanceReset', 'true');
            }
            
            // Initialize Lucide icons for modals
            setTimeout(() => {
                lucide.createIcons();
            }, 500);
        });
        
        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                link.style.background = 'rgba(255, 255, 255, 0.2)';
                link.style.color = '#374151';
            });
            
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav link
            const activeLink = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
            if (activeLink) {
                activeLink.classList.add('active');
                activeLink.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(99, 102, 241, 0.9))';
                activeLink.style.color = 'white';
            }
            
            // Refresh data when switching sections
            setTimeout(() => {
                if (sectionId === 'dashboard') {
                    updateDashboardStats();
                    updateAttendanceChart();
                } else if (sectionId === 'students') {
                    renderAllStudentsList();
                    updateClassAttendanceRates();
                } else if (sectionId === 'qr-scanner') {
                    updateScannerStats();
                    renderRecentScans();
                } else if (sectionId === 'generate-qr') {
                    populateStudentSelect();
                } else if (sectionId === 'blocked') {
                    renderBlockedStudentsList();
                    updateBlockedStats();
                }
            }, 100);
        }
    </script>
</body>
</html>